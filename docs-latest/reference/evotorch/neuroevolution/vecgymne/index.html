
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="EvoTorch is an open source evolutionary computation library developed at NNAISENSE, built on top of PyTorch.">
      
      
      
      <link rel="icon" href="../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>vecgymne - EvoTorch</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#evotorch.neuroevolution.vecgymne" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://evotorch.ai" title="EvoTorch" class="md-header__button md-logo" aria-label="EvoTorch" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EvoTorch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              vecgymne
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nnaisense/evotorch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    evotorch
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../quickstart/" class="md-tabs__link">
      Quickstart
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../user_guide/general_usage/" class="md-tabs__link">
        User Guide
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../advanced_usage/solution_batch/" class="md-tabs__link">
        Advanced Usage
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../examples/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        API Reference
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://evotorch.ai" title="EvoTorch" class="md-nav__button md-logo" aria-label="EvoTorch" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EvoTorch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nnaisense/evotorch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    evotorch
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/general_usage/" class="md-nav__link">
        General Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/algorithm_usage/" class="md-nav__link">
        Algorithm Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/algorithms_tour/" class="md-nav__link">
        Algorithms Tour
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/problems/" class="md-nav__link">
        Defining Problems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/problem_parallelization/" class="md-nav__link">
        Problem Parallelization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/neuroevolution/" class="md-nav__link">
        Neuroevolution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/gym/" class="md-nav__link">
        Neuroevolution for Gym
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user_guide/supervised_ne/" class="md-nav__link">
        Supervised Neuroevolution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Advanced Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Advanced Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced_usage/solution_batch/" class="md-nav__link">
        Manipulating Solutions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced_usage/hooks/" class="md-nav__link">
        Using Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced_usage/dist_based/" class="md-nav__link">
        Distributed Evolution Strategies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced_usage/custom_ea/" class="md-nav__link">
        Custom Searchers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced_usage/custom_logger/" class="md-nav__link">
        Custom Loggers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advanced_usage/ray_cluster/" class="md-nav__link">
        Using Ray Clusters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../examples/">Examples</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Notebooks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Notebooks" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Notebooks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/notebooks/Gym_Experiments_with_PGPE_and_CoSyNE/" class="md-nav__link">
        Gym Experiments with PGPE and CoSyNE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/notebooks/Training_MNIST30K/" class="md-nav__link">
        Training MNIST30K
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/notebooks/Variational_Quantum_Eigensolvers_with_SNES/" class="md-nav__link">
        Variational Quantum Eigensolvers with SNES
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/notebooks/Brax_Experiments_with_PGPE/" class="md-nav__link">
        Solving a Brax environment using EvoTorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/notebooks/Minimizing_Lennard-Jones_Atom_Cluster_Potentials/" class="md-nav__link">
        Minimising Lennard-Jones Atom Cluster Potentials with Evolution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/notebooks/reacher_mpc/" class="md-nav__link">
        Model Predictive Control (MPC) with EvoTorch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">API Reference</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../algorithms/">evotorch.algorithms</a>
          
            <label for="__nav_6_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="evotorch.algorithms" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          evotorch.algorithms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/cmaes/" class="md-nav__link">
        cmaes
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_3" type="checkbox" id="__nav_6_2_3" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../algorithms/distributed/">distributed</a>
          
            <label for="__nav_6_2_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="distributed" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_3">
          <span class="md-nav__icon md-icon"></span>
          distributed
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/distributed/gaussian/" class="md-nav__link">
        gaussian
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/ga/" class="md-nav__link">
        ga
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/searchalgorithm/" class="md-nav__link">
        searchalgorithm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        evotorch.core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decorators/" class="md-nav__link">
        evotorch.decorators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../distributions/" class="md-nav__link">
        evotorch.distributions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../logging/" class="md-nav__link">
        evotorch.logging
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" type="checkbox" id="__nav_6_7" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">evotorch.neuroevolution</a>
          
            <label for="__nav_6_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="evotorch.neuroevolution" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_7">
          <span class="md-nav__icon md-icon"></span>
          evotorch.neuroevolution
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../baseneproblem/" class="md-nav__link">
        baseneproblem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gymne/" class="md-nav__link">
        gymne
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../neproblem/" class="md-nav__link">
        neproblem
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7_5" type="checkbox" id="__nav_6_7_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../net/">net</a>
          
            <label for="__nav_6_7_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="net" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_7_5">
          <span class="md-nav__icon md-icon"></span>
          net
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/functional/" class="md-nav__link">
        functional
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/layers/" class="md-nav__link">
        layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/misc/" class="md-nav__link">
        misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/multilayered/" class="md-nav__link">
        multilayered
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/parser/" class="md-nav__link">
        parser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/rl/" class="md-nav__link">
        rl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/runningnorm/" class="md-nav__link">
        runningnorm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/runningstat/" class="md-nav__link">
        runningstat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/statefulmodule/" class="md-nav__link">
        statefulmodule
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../net/vecrl/" class="md-nav__link">
        vecrl
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../supervisedne/" class="md-nav__link">
        supervisedne
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          vecgymne
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        vecgymne
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne" class="md-nav__link">
    evotorch.neuroevolution.vecgymne
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE" class="md-nav__link">
    VecGymNE
  </a>
  
    <nav class="md-nav" aria-label="VecGymNE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.episode_count" class="md-nav__link">
    episode_count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.interaction_count" class="md-nav__link">
    interaction_count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.max_num_envs" class="md-nav__link">
    max_num_envs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.network_device" class="md-nav__link">
    network_device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.get_env" class="md-nav__link">
    get_env()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.get_observation_stats" class="md-nav__link">
    get_observation_stats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.make_net" class="md-nav__link">
    make_net()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.pop_observation_stats" class="md-nav__link">
    pop_observation_stats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.save_solution" class="md-nav__link">
    save_solution()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_episode_count" class="md-nav__link">
    set_episode_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_interaction_count" class="md-nav__link">
    set_interaction_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_observation_stats" class="md-nav__link">
    set_observation_stats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.to_policy" class="md-nav__link">
    to_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.update_observation_stats" class="md-nav__link">
    update_observation_stats()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_8" type="checkbox" id="__nav_6_8" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../operators/">evotorch.operators</a>
          
            <label for="__nav_6_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="evotorch.operators" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_8">
          <span class="md-nav__icon md-icon"></span>
          evotorch.operators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operators/base/" class="md-nav__link">
        base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operators/real/" class="md-nav__link">
        real
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operators/sequence/" class="md-nav__link">
        sequence
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimizers/" class="md-nav__link">
        evotorch.optimizers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        evotorch.testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_11" type="checkbox" id="__nav_6_11" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../tools/">evotorch.tools</a>
          
            <label for="__nav_6_11">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="evotorch.tools" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_11">
          <span class="md-nav__icon md-icon"></span>
          evotorch.tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/cloning/" class="md-nav__link">
        cloning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/hook/" class="md-nav__link">
        hook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/immutable/" class="md-nav__link">
        immutable
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/misc/" class="md-nav__link">
        misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/objectarray/" class="md-nav__link">
        objectarray
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/ranking/" class="md-nav__link">
        ranking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/readonlytensor/" class="md-nav__link">
        readonlytensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/recursiveprintable/" class="md-nav__link">
        recursiveprintable
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/tensormaker/" class="md-nav__link">
        tensormaker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne" class="md-nav__link">
    evotorch.neuroevolution.vecgymne
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE" class="md-nav__link">
    VecGymNE
  </a>
  
    <nav class="md-nav" aria-label="VecGymNE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.episode_count" class="md-nav__link">
    episode_count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.interaction_count" class="md-nav__link">
    interaction_count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.max_num_envs" class="md-nav__link">
    max_num_envs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.network_device" class="md-nav__link">
    network_device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.get_env" class="md-nav__link">
    get_env()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.get_observation_stats" class="md-nav__link">
    get_observation_stats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.make_net" class="md-nav__link">
    make_net()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.pop_observation_stats" class="md-nav__link">
    pop_observation_stats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.save_solution" class="md-nav__link">
    save_solution()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_episode_count" class="md-nav__link">
    set_episode_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_interaction_count" class="md-nav__link">
    set_interaction_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_observation_stats" class="md-nav__link">
    set_observation_stats()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.to_policy" class="md-nav__link">
    to_policy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evotorch.neuroevolution.vecgymne.VecGymNE.update_observation_stats" class="md-nav__link">
    update_observation_stats()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/nnaisense/evotorch/edit/master/docs/src/evotorch/neuroevolution/vecgymne.py" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>vecgymne</h1>

<div class="doc doc-object doc-module">

<a id="evotorch.neuroevolution.vecgymne"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="evotorch.neuroevolution.vecgymne.VecGymNE" class="doc doc-heading">
        <code>
VecGymNE            (<a class="autorefs autorefs-internal" title="evotorch.neuroevolution.baseneproblem.BaseNEProblem" href="../baseneproblem/#evotorch.neuroevolution.baseneproblem.BaseNEProblem">BaseNEProblem</a>)
        </code>



<a href="#evotorch.neuroevolution.vecgymne.VecGymNE" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>An EvoTorch problem for solving vectorized gym environments</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">class</span> <span class="nc">VecGymNE</span><span class="p">(</span><span class="n">BaseNEProblem</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    An EvoTorch problem for solving vectorized gym environments</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="n">env</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        <span class="n">network</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span class="n">env_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        <span class="n">max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">network_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="n">observation_normalization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        <span class="n">decrease_rewards_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        <span class="n">alive_bonus_schedule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="n">action_noise_stdev</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>        <span class="n">num_actors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;num_devices&quot;</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>        <span class="n">num_gpus_per_actor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="n">num_subbatches</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        <span class="n">subbatch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>        <span class="n">actor_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="sd">        Initialize the VecGymNE.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="sd">            env: Environment to be solved.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="sd">                If this is given as a string starting with &quot;gym::&quot; (e.g.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="sd">                &quot;gym::Humanoid-v4&quot;, etc.), then it is assumed that the target</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="sd">                environment is a classical gym environment.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="sd">                If this is given as a string starting with &quot;brax::&quot; (e.g.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="sd">                &quot;brax::humanoid&quot;, etc.), then it is assumed that the target</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="sd">                environment is a brax environment.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="sd">                If this is given as a string which does not contain &quot;::&quot; at</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="sd">                all (e.g. &quot;Humanoid-v4&quot;, etc.), then it is assumed that the</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="sd">                target environment is a classical gym environment. Therefore,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="sd">                &quot;gym::Humanoid-v4&quot; and &quot;Humanoid-v4&quot; are equivalent.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="sd">                If this argument is given as a Callable (maybe a function or a</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="sd">                class), then, with the assumption that this Callable expects</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="sd">                a keyword argument `num_envs: int`, this Callable is called</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="sd">                and its result (expected as a `gym.vector.VectorEnv` instance)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="sd">                is used as the environment.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="sd">            network: A network structure string, or a Callable (which can be</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="sd">                a class inheriting from `torch.nn.Module`, or a function</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="sd">                which returns a `torch.nn.Module` instance), or an instance</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="sd">                of `torch.nn.Module`.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="sd">                The object provided here determines the structure of the</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="sd">                neural network whose parameters will be evolved.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="sd">                A network structure string is a string which can be processed</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="sd">                by `evotorch.neuroevolution.net.str_to_net(...)`.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="sd">                Please see the documentation of the function</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="sd">                `evotorch.neuroevolution.net.str_to_net(...)` to see how such</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="sd">                a neural network structure string looks like.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="sd">                Note that this network can be a recurrent network.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="sd">                When the network&#39;s `forward(...)` method can optionally accept</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="sd">                an additional positional argument for the hidden state of the</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="sd">                network and returns an additional value for its next state,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="sd">                then the policy is treated as a recurrent one.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="sd">                When the network is given as a callable object (e.g.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="sd">                a subclass of `nn.Module` or a function) and this callable</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="sd">                object is decorated via `evotorch.decorators.pass_info`,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="sd">                the following keyword arguments will be passed:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="sd">                (i) `obs_length` (the length of the observation vector),</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="sd">                (ii) `act_length` (the length of the action vector),</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="sd">                (iii) `obs_shape` (the shape tuple of the observation space),</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="sd">                (iv) `act_shape` (the shape tuple of the action space),</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="sd">                (v) `obs_space` (the Box object specifying the observation</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="sd">                space, and</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="sd">                (vi) `act_space` (the Box object specifying the action</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="sd">                space). Note that `act_space` will always be given as a</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="sd">                `gym.spaces.Box` instance, even when the actual gym</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="sd">                environment has a discrete action space. This because</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="sd">                `VecGymNE` always expects the neural network to return</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="sd">                a tensor of floating-point numbers.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="sd">            env_config: Keyword arguments to pass to the environment while</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="sd">                it is being created.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="sd">            max_num_envs: Maximum number of environments to be instantiated.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="sd">                By default, this is None, which means that the number of</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="sd">                environments can go up to the population size (or up to the</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="sd">                number of solutions that a remote actor receives, if the</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="sd">                problem object is configured to have parallelization).</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="sd">                For situations where the current reinforcement learning task</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="sd">                requires large amount of resources (e.g. memory), allocating</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="sd">                environments as much as the number of solutions might not</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="sd">                be feasible. In such cases, one can set `max_num_envs` as an</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="sd">                integer to bring an upper bound (in total, across all the</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="sd">                remote actors, for when the problem is parallelized) to how</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="sd">                many environments can be allocated.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="sd">            network_args: Any additional keyword argument to be used when</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="sd">                instantiating the network can be specified via `network_args`</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="sd">                as a dictionary. If there are no such additional keyword</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="sd">                arguments, then `network_args` can be left as None.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="sd">                Note that the argument `network_args` is expected to be None</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="sd">                when the network is specified as a `torch.nn.Module` instance.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="sd">            observation_normalization: Whether or not online normalization</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="sd">                will be done on the encountered observations.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="sd">            decrease_rewards_by: If given as a float, each reward will be</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="sd">                decreased by this amount. For example, if the environment&#39;s</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="sd">                reward function has a constant &quot;alive bonus&quot; (i.e. a bonus</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="sd">                that is constantly added onto the reward as long as the</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="sd">                agent is alive), and if you wish to negate this bonus,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="sd">                you can set `decrease_rewards_by` to this bonus amount,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="sd">                and the bonus will be nullified.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="sd">                If you do not wish to affect the rewards in this manner,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="sd">                keep this as None.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="sd">            alive_bonus_schedule: Use this to add a customized amount of</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="sd">                alive bonus.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="sd">                If left as None (which is the default), additional alive</span>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="sd">                bonus will not be added.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="sd">                If given as a tuple `(t, b)`, an alive bonus `b` will be</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="sd">                added onto all the rewards beyond the timestep `t`.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="sd">                If given as a tuple `(t0, t1, b)`, a partial (linearly</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a><span class="sd">                increasing towards `b`) alive bonus will be added onto</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="sd">                all the rewards between the timesteps `t0` and `t1`,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="sd">                and a full alive bonus (which equals to `b`) will be added</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a><span class="sd">                onto all the rewards beyond the timestep `t1`.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="sd">            action_noise_stdev: If given as a real number `s`, then, for</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="sd">                each generated action, Gaussian noise with standard</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a><span class="sd">                deviation `s` will be sampled, and then this sampled noise</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="sd">                will be added onto the action.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="sd">                If action noise is not desired, then this argument can be</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="sd">                left as None.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a><span class="sd">                For sampling the noise, the global random number generator</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="sd">                of PyTorch on the simulator&#39;s device will be used.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="sd">            num_episodes: Number of episodes over which each policy will</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="sd">                be evaluated. The default is 1.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a><span class="sd">            device: The device in which the population will be kept.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="sd">                If you wish to do a single-GPU evolution, we recommend</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a><span class="sd">                to set this as &quot;cuda&quot; (or &quot;cuda:0&quot;, or &quot;cuda:1&quot;, etc.),</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a><span class="sd">                assuming that the simulator will also instantiate itself</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a><span class="sd">                on that same device.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="sd">                Alternatively, if you wish to do a multi-GPU evolution,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="sd">                we recommend to leave this as None or set this as &quot;cpu&quot;,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a><span class="sd">                so that the main population will be kept on the cpu</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a><span class="sd">                and the remote actors will perform their evaluations on</span>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="sd">                the GPUs that are assigned to them.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a><span class="sd">            num_actors: Number of actors.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a><span class="sd">                This is, by default, &quot;num_devices&quot; which creates multiple</span>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="sd">                actors in such a way that each actor will be assigned</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="sd">                an entire GPU.</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a><span class="sd">                This default setting considers the multi-GPU scenario</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a><span class="sd">                (and requires multiple GPUs to work correctly).</span>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a><span class="sd">                If you wish to perform the entire evolution on a single</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="sd">                GPU, we recommend to set `num_actors` as 0 (so that there</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a><span class="sd">                will be no remote actors) and set `device` as &quot;cuda&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="sd">                (or &quot;cuda:0&quot;, or &quot;cuda:1&quot;, etc., the device in which the</span>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a><span class="sd">                simulator will be instantiated).</span>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="sd">                If you do not have any GPUs the special value &quot;num_devices&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="sd">                will allocate n actors, n being the number of CPUs.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="sd">                You can also set `num_actors` as an integer to determine</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="sd">                the exact number of subprocesses which will evaluate the</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a><span class="sd">                solutions in parallel. Note that, however, when you set</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a><span class="sd">                `num_actors` as an integer, you will also have to explicitly</span>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a><span class="sd">                specify the number of GPUs each actor will be assigned</span>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="sd">                via the argument `num_gpus_per_actor`.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a><span class="sd">            num_gpus_per_actor: Number of GPUs to be assigned to each</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="sd">                actor. This can be an integer or a float (for when you</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a><span class="sd">                wish to assign fractional amounts of GPUs to actors).</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="sd">                When `num_actors` has the special value &quot;num_devices&quot;,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="sd">                the argument `num_gpus_per_actor` is expected to be left as</span>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="sd">                None.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="sd">            num_subbatches: For when there are multiple actors, you can</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="sd">                set this to an integer n if you wish the population</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="sd">                to be divided exactly into n sub-batches. The actors, as they</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a><span class="sd">                finish their currently assigned sub-batch of solutions,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a><span class="sd">                will pick the next un-evaluated sub-batch.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a><span class="sd">                If you specify too large numbers for this argument, then</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a><span class="sd">                each sub-batch will be smaller.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a><span class="sd">                When working with vectorized simulators on GPU, having too</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a><span class="sd">                many and too small sub-batches can hurt the performance.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="sd">                This argument can be left as None, in which case, assuming</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a><span class="sd">                that `subbatch_size` is also None, the population will be</span>
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="sd">                split to m sub-batches, m being the number of actors.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="sd">            subbatch_size: For when there are multiple actors, you can</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a><span class="sd">                set this to an integer n if you wish the population to be</span>
<a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a><span class="sd">                divided into sub-batches in such a way that each sub-batch</span>
<a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a><span class="sd">                will consist of exactly n solutions. The actors, as they</span>
<a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="sd">                finish their currently assigned sub-batch of solutions,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a><span class="sd">                will pick the next un-evaluated sub-batch.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a><span class="sd">                If you specify too small numbers for this argument, then</span>
<a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a><span class="sd">                there will be many sub-batches, each sub-batch having a</span>
<a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a><span class="sd">                small number of solutions.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="sd">                When working with vectorized simulators on GPU, having too</span>
<a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="sd">                many and too small sub-batches can hurt the performance.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a><span class="sd">                This argument can be left as None, in which case, assuming</span>
<a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a><span class="sd">                that `num_subbatches` is also None, the population will be</span>
<a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a><span class="sd">                split to m sub-batches, m being the number of actors.</span>
<a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a><span class="sd">            actor_config: Additional configuration to be used when creating</span>
<a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a><span class="sd">                each actor with the help of `ray` library.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a><span class="sd">                Can be left as None if additional configuration is not needed.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a>        <span class="c1"># Store the string or the Callable that will be used to generate the reinforcement learning environment.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span> <span class="o">=</span> <span class="n">env</span>
<a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a>        <span class="c1"># Declare the variable which will store the environment.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TorchWrapper</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a>        <span class="c1"># Declare the variable which will store the batch size of the vectorized environment.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a>        <span class="c1"># Store the upper bound (if any) regarding how many environments can exist at the same time.</span>
<a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">max_num_envs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_num_envs</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a>        <span class="c1"># Actor-specific upper bound regarding how many environments can exist at the same time.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a>        <span class="c1"># This variable will be filled by the `_parallelize(...)` method.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a>        <span class="c1"># Declare the variable which stores whether or not we properly initialized the `_actor_max_num_envs` variable.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs_ready</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a>        <span class="c1"># Store the additional configurations to be used as keyword arguments while instantiating the environment.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">env_config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">env_config</span><span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a>        <span class="c1"># Declare the variable that will store the device of the simulator.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a>        <span class="c1"># This variable will be filled when the first observation is received from the environment.</span>
<a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a>        <span class="c1"># The device of the observation array received from the environment will determine the value of this variable.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a>        <span class="c1"># Store the neural network architecture (that might be a string or an `nn.Module` instance).</span>
<a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_architecture</span> <span class="o">=</span> <span class="n">network</span>
<a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a>        <span class="k">if</span> <span class="n">network_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a>            <span class="c1"># If `network_args` is given as None, change it to an empty dictionary</span>
<a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a>            <span class="n">network_args</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>            <span class="c1"># If the network is given as a string, then we will need the values for the constants `obs_length`,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a>            <span class="c1"># `act_length`, and `obs_space`. To obtain those values, we use our helper function</span>
<a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a>            <span class="c1"># `_env_constants_for_str_net(...)` which temporarily instantiates the specified environment and returns</span>
<a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a>            <span class="c1"># its needed constants.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a>            <span class="n">env_constants</span> <span class="o">=</span> <span class="n">_env_constants_for_str_net</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">))</span>
<a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>            <span class="c1"># If the network is an already instantiated nn.Module, then we do not prepare any pre-defined constants.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a>            <span class="n">env_constants</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a>            <span class="c1"># If the network is given as a Callable, then we will need the values for the constants `obs_length`,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a>            <span class="c1"># `act_length`, and `obs_space`. To obtain those values, we use our helper function</span>
<a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a>            <span class="c1"># `_env_constants_for_callable_net(...)` which temporarily instantiates the specified environment and</span>
<a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>            <span class="c1"># returns its needed constants.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a>            <span class="n">env_constants</span> <span class="o">=</span> <span class="n">_env_constants_for_callable_net</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">))</span>
<a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a>        <span class="c1"># Build a `Policy` instance according to the given architecture, and store it.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a>            <span class="n">instantiated_net</span> <span class="o">=</span> <span class="n">str_to_net</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">env_constants</span><span class="p">,</span> <span class="o">**</span><span class="n">network_args</span><span class="p">})</span>
<a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a>            <span class="n">instantiated_net</span> <span class="o">=</span> <span class="n">network</span>
<a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a>            <span class="n">instantiated_net</span> <span class="o">=</span> <span class="n">pass_info_if_needed</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">env_constants</span><span class="p">)(</span><span class="o">**</span><span class="n">network_args</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span> <span class="o">=</span> <span class="n">Policy</span><span class="p">(</span><span class="n">instantiated_net</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a>        <span class="c1"># Store the boolean which indicates whether or not there will be observation normalization.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_normalization</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">observation_normalization</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a>        <span class="c1"># Declare the variables that will store the observation-related stats if observation normalization is enabled.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RunningNorm</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RunningNorm</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a>        <span class="c1"># Store the number of episodes configuration given by the user.</span>
<a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_episodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_episodes</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a>        <span class="c1"># Store the `decrease_rewards_by` configuration given by the user.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decrease_rewards_by</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">decrease_rewards_by</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">decrease_rewards_by</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a>        <span class="k">if</span> <span class="n">alive_bonus_schedule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a>            <span class="c1"># If `alive_bonus_schedule` argument is None, then we store it as None as well.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>            <span class="c1"># This is the case where the user has specified an `alive_bonus_schedule`.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a>            <span class="n">alive_bonus_schedule</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a>            <span class="n">alive_bonus_schedule_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a>            <span class="k">if</span> <span class="n">alive_bonus_schedule_length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a>                <span class="c1"># If `alive_bonus_schedule` was given as a 2-element sequence (t, b), then store it as (t, t, b).</span>
<a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a>                <span class="c1"># This means that the partial alive bonus time window starts and ends at t, therefore, there will</span>
<a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>                <span class="c1"># be no alive bonus until t, and beginning with t, there will be full alive bonus.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a>                    <span class="nb">float</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a>                <span class="p">]</span>
<a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a>            <span class="k">elif</span> <span class="n">alive_bonus_schedule_length</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a>                <span class="c1"># If `alive_bonus_schedule` was given as a 3-element sequence (t0, t1, b), then store those 3</span>
<a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a>                <span class="c1"># elements.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a>                    <span class="nb">float</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
<a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a>                <span class="p">]</span>
<a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a>                <span class="c1"># `alive_bonus_schedule` sequences with unrecognized lengths trigger an error.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a>                    <span class="sa">f</span><span class="s2">&quot;Received invalid number elements as the alive bonus schedule.&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a>                    <span class="sa">f</span><span class="s2">&quot; Expected 2 or 3 items, but got these: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a>                    <span class="sa">f</span><span class="s2">&quot; (having a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a>                <span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a>        <span class="c1"># If `action_noise_stdev` is specified, store it.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_action_noise_stdev</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">action_noise_stdev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">action_noise_stdev</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a>        <span class="c1"># Initialize the counters for the number of simulator interactions and the number of episodes.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a>        <span class="c1"># Call the superclass</span>
<a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a>            <span class="n">objective_sense</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a>            <span class="n">initial_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">),</span>
<a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a>            <span class="n">solution_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">parameter_length</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a>            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a>            <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a>            <span class="n">num_actors</span><span class="o">=</span><span class="n">num_actors</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315" href="#__codelineno-0-315"></a>            <span class="n">num_gpus_per_actor</span><span class="o">=</span><span class="n">num_gpus_per_actor</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316" href="#__codelineno-0-316"></a>            <span class="n">actor_config</span><span class="o">=</span><span class="n">actor_config</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317" href="#__codelineno-0-317"></a>            <span class="n">num_subbatches</span><span class="o">=</span><span class="n">num_subbatches</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318" href="#__codelineno-0-318"></a>            <span class="n">subbatch_size</span><span class="o">=</span><span class="n">subbatch_size</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319" href="#__codelineno-0-319"></a>        <span class="p">)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320" href="#__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321" href="#__codelineno-0-321"></a>    <span class="k">def</span> <span class="nf">_parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-322" name="__codelineno-0-322" href="#__codelineno-0-322"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_parallelize</span><span class="p">()</span>
<a id="__codelineno-0-323" name="__codelineno-0-323" href="#__codelineno-0-323"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324" href="#__codelineno-0-324"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs_ready</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325" href="#__codelineno-0-325"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326" href="#__codelineno-0-326"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_num_envs</span>
<a id="__codelineno-0-327" name="__codelineno-0-327" href="#__codelineno-0-327"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328" href="#__codelineno-0-328"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_num_envs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329" href="#__codelineno-0-329"></a>                        <span class="n">max_num_envs_per_actor</span> <span class="o">=</span> <span class="n">split_workload</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_num_envs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actors</span><span class="p">))</span>
<a id="__codelineno-0-330" name="__codelineno-0-330" href="#__codelineno-0-330"></a>                        <span class="k">for</span> <span class="n">i_actor</span><span class="p">,</span> <span class="n">actor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actors</span><span class="p">):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331" href="#__codelineno-0-331"></a>                            <span class="n">actor</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="s2">&quot;_set_actor_max_num_envs&quot;</span><span class="p">,</span> <span class="n">max_num_envs_per_actor</span><span class="p">[</span><span class="n">i_actor</span><span class="p">])</span>
<a id="__codelineno-0-332" name="__codelineno-0-332" href="#__codelineno-0-332"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs_ready</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-333" name="__codelineno-0-333" href="#__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334" href="#__codelineno-0-334"></a>    <span class="k">def</span> <span class="nf">_set_actor_max_num_envs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335" href="#__codelineno-0-335"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span> <span class="o">=</span> <span class="n">n</span>
<a id="__codelineno-0-336" name="__codelineno-0-336" href="#__codelineno-0-336"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs_ready</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-337" name="__codelineno-0-337" href="#__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338" href="#__codelineno-0-338"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-339" name="__codelineno-0-339" href="#__codelineno-0-339"></a>    <span class="k">def</span> <span class="nf">observation_normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340" href="#__codelineno-0-340"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_normalization</span>
<a id="__codelineno-0-341" name="__codelineno-0-341" href="#__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342" href="#__codelineno-0-342"></a>    <span class="k">def</span> <span class="nf">set_episode_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-343" name="__codelineno-0-343" href="#__codelineno-0-343"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-344" name="__codelineno-0-344" href="#__codelineno-0-344"></a><span class="sd">        Set the episode count manually.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345" href="#__codelineno-0-345"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-346" name="__codelineno-0-346" href="#__codelineno-0-346"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347" href="#__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348" href="#__codelineno-0-348"></a>    <span class="k">def</span> <span class="nf">set_interaction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-349" name="__codelineno-0-349" href="#__codelineno-0-349"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350" href="#__codelineno-0-350"></a><span class="sd">        Set the interaction count manually.</span>
<a id="__codelineno-0-351" name="__codelineno-0-351" href="#__codelineno-0-351"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352" href="#__codelineno-0-352"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-0-353" name="__codelineno-0-353" href="#__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354" href="#__codelineno-0-354"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-355" name="__codelineno-0-355" href="#__codelineno-0-355"></a>    <span class="k">def</span> <span class="nf">interaction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356" href="#__codelineno-0-356"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357" href="#__codelineno-0-357"></a><span class="sd">        Get the total number of simulator interactions made.</span>
<a id="__codelineno-0-358" name="__codelineno-0-358" href="#__codelineno-0-358"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-359" name="__codelineno-0-359" href="#__codelineno-0-359"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_count</span>
<a id="__codelineno-0-360" name="__codelineno-0-360" href="#__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361" href="#__codelineno-0-361"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-362" name="__codelineno-0-362" href="#__codelineno-0-362"></a>    <span class="k">def</span> <span class="nf">episode_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363" href="#__codelineno-0-363"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-364" name="__codelineno-0-364" href="#__codelineno-0-364"></a><span class="sd">        Get the total number of episodes completed.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365" href="#__codelineno-0-365"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366" href="#__codelineno-0-366"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span>
<a id="__codelineno-0-367" name="__codelineno-0-367" href="#__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368" href="#__codelineno-0-368"></a>    <span class="k">def</span> <span class="nf">_get_local_episode_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-369" name="__codelineno-0-369" href="#__codelineno-0-369"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span>
<a id="__codelineno-0-370" name="__codelineno-0-370" href="#__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371" href="#__codelineno-0-371"></a>    <span class="k">def</span> <span class="nf">_get_local_interaction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372" href="#__codelineno-0-372"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span>
<a id="__codelineno-0-373" name="__codelineno-0-373" href="#__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374" href="#__codelineno-0-374"></a>    <span class="k">def</span> <span class="nf">_get_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_policies</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TorchWrapper</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375" href="#__codelineno-0-375"></a>        <span class="c1"># Get the existing environment instance stored by this VecGymNE, after (re)building it if needed.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376" href="#__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377" href="#__codelineno-0-377"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">num_policies</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_envs</span><span class="p">):</span>
<a id="__codelineno-0-378" name="__codelineno-0-378" href="#__codelineno-0-378"></a>            <span class="c1"># If this VecGymNE does not have its environment ready yet (i.e. the `_env` attribute is None)</span>
<a id="__codelineno-0-379" name="__codelineno-0-379" href="#__codelineno-0-379"></a>            <span class="c1"># or it the batch size of the previously instantiated environment is not enough to deal with</span>
<a id="__codelineno-0-380" name="__codelineno-0-380" href="#__codelineno-0-380"></a>            <span class="c1"># the number of policies (i.e. the `_num_envs` attribute is less than `num_policies`), then</span>
<a id="__codelineno-0-381" name="__codelineno-0-381" href="#__codelineno-0-381"></a>            <span class="c1"># we (re)build the environment.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382" href="#__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383" href="#__codelineno-0-383"></a>            <span class="c1"># Keyword arguments to pass to the TorchWrapper.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384" href="#__codelineno-0-384"></a>            <span class="n">torch_wrapper_cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-385" name="__codelineno-0-385" href="#__codelineno-0-385"></a>                <span class="n">force_classic_api</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386" href="#__codelineno-0-386"></a>                <span class="n">discrete_to_continuous_act</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387" href="#__codelineno-0-387"></a>                <span class="n">clip_actions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388" href="#__codelineno-0-388"></a>            <span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389" href="#__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390" href="#__codelineno-0-390"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-391" name="__codelineno-0-391" href="#__codelineno-0-391"></a>                <span class="c1"># If the environment is specified via a string, then we use our `make_vector_env` function.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392" href="#__codelineno-0-392"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">make_vector_env</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393" href="#__codelineno-0-393"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="n">num_envs</span><span class="o">=</span><span class="n">num_policies</span><span class="p">,</span> <span class="o">**</span><span class="n">torch_wrapper_cfg</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394" href="#__codelineno-0-394"></a>                <span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395" href="#__codelineno-0-395"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396" href="#__codelineno-0-396"></a>                <span class="c1"># If the environment is specified via a Callable, then we call it.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397" href="#__codelineno-0-397"></a>                <span class="c1"># We expect this Callable to accept a keyword argument named `num_envs`, and additionally, we pass</span>
<a id="__codelineno-0-398" name="__codelineno-0-398" href="#__codelineno-0-398"></a>                <span class="c1"># the environment configuration dictionary as keyword arguments.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399" href="#__codelineno-0-399"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">(</span><span class="n">num_envs</span><span class="o">=</span><span class="n">num_policies</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">))</span>
<a id="__codelineno-0-400" name="__codelineno-0-400" href="#__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401" href="#__codelineno-0-401"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">VectorEnv</span><span class="p">):</span>
<a id="__codelineno-0-402" name="__codelineno-0-402" href="#__codelineno-0-402"></a>                    <span class="c1"># If what is returned by the Callable is not a vectorized environment, then we trigger an error.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403" href="#__codelineno-0-403"></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;This is not a vectorized environment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404" href="#__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405" href="#__codelineno-0-405"></a>                <span class="c1"># We wrap the returned vectorized environment with a TorchWrapper, so that the actions that we send</span>
<a id="__codelineno-0-406" name="__codelineno-0-406" href="#__codelineno-0-406"></a>                <span class="c1"># and the observations and rewards that we receive are PyTorch tensors.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407" href="#__codelineno-0-407"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">TorchWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> <span class="o">**</span><span class="n">torch_wrapper_cfg</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408" href="#__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409" href="#__codelineno-0-409"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">num_envs</span> <span class="o">!=</span> <span class="n">num_policies</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410" href="#__codelineno-0-410"></a>                <span class="c1"># If the finally obtained vectorized environment has a different number of batch size, then we trigger</span>
<a id="__codelineno-0-411" name="__codelineno-0-411" href="#__codelineno-0-411"></a>                <span class="c1"># an error.</span>
<a id="__codelineno-0-412" name="__codelineno-0-412" href="#__codelineno-0-412"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incompatible number of environments&quot;</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413" href="#__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414" href="#__codelineno-0-414"></a>            <span class="c1"># We update the batch size of the created environment.</span>
<a id="__codelineno-0-415" name="__codelineno-0-415" href="#__codelineno-0-415"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_num_envs</span> <span class="o">=</span> <span class="n">num_policies</span>
<a id="__codelineno-0-416" name="__codelineno-0-416" href="#__codelineno-0-416"></a>
<a id="__codelineno-0-417" name="__codelineno-0-417" href="#__codelineno-0-417"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">single_observation_space</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
<a id="__codelineno-0-418" name="__codelineno-0-418" href="#__codelineno-0-418"></a>                <span class="c1"># If the observation space is not Box, then we trigger an error.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419" href="#__codelineno-0-419"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420" href="#__codelineno-0-420"></a>                    <span class="sa">f</span><span class="s2">&quot;Unsupported observation type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">single_observation_space</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421" href="#__codelineno-0-421"></a>                    <span class="sa">f</span><span class="s2">&quot; Only Box-typed observation spaces are supported.&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422" href="#__codelineno-0-422"></a>                <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423" href="#__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424" href="#__codelineno-0-424"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425" href="#__codelineno-0-425"></a>                <span class="c1"># If possible, use the `seed(...)` method to explicitly randomize the environment.</span>
<a id="__codelineno-0-426" name="__codelineno-0-426" href="#__codelineno-0-426"></a>                <span class="c1"># Although the new gym API removed the seed method, some environments define their own `seed(...)`</span>
<a id="__codelineno-0-427" name="__codelineno-0-427" href="#__codelineno-0-427"></a>                <span class="c1"># method for randomization.</span>
<a id="__codelineno-0-428" name="__codelineno-0-428" href="#__codelineno-0-428"></a>                <span class="n">new_seed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429" href="#__codelineno-0-429"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">new_seed</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430" href="#__codelineno-0-430"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431" href="#__codelineno-0-431"></a>                <span class="c1"># Our attempt at manually seeding the environment has failed.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432" href="#__codelineno-0-432"></a>                <span class="c1"># This could be because the environment does not have a `seed(...)` method.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433" href="#__codelineno-0-433"></a>                <span class="c1"># Nothing to do.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434" href="#__codelineno-0-434"></a>                <span class="k">pass</span>
<a id="__codelineno-0-435" name="__codelineno-0-435" href="#__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436" href="#__codelineno-0-436"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span>
<a id="__codelineno-0-437" name="__codelineno-0-437" href="#__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438" href="#__codelineno-0-438"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-439" name="__codelineno-0-439" href="#__codelineno-0-439"></a>    <span class="k">def</span> <span class="nf">_nonserialized_attribs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-440" name="__codelineno-0-440" href="#__codelineno-0-440"></a>        <span class="c1"># Call the `_nonserialized_attribs` property implementation of the superclass to receive the base list</span>
<a id="__codelineno-0-441" name="__codelineno-0-441" href="#__codelineno-0-441"></a>        <span class="c1"># of non-serialized attributes, then add &quot;_env&quot; to this base list, and then return the resulting list.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442" href="#__codelineno-0-442"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_nonserialized_attribs</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;_env&quot;</span><span class="p">]</span>
<a id="__codelineno-0-443" name="__codelineno-0-443" href="#__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444" href="#__codelineno-0-444"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-445" name="__codelineno-0-445" href="#__codelineno-0-445"></a>    <span class="k">def</span> <span class="nf">_grad_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446" href="#__codelineno-0-446"></a>        <span class="c1"># For distributed mode, this property determines the device in which the temporary populations will be made</span>
<a id="__codelineno-0-447" name="__codelineno-0-447" href="#__codelineno-0-447"></a>        <span class="c1"># for gradient computation.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448" href="#__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449" href="#__codelineno-0-449"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450" href="#__codelineno-0-450"></a>            <span class="c1"># If the simulator device is not known yet, then we return the cpu device.</span>
<a id="__codelineno-0-451" name="__codelineno-0-451" href="#__codelineno-0-451"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452" href="#__codelineno-0-452"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453" href="#__codelineno-0-453"></a>            <span class="c1"># If the simulator device is known, then we return that device.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454" href="#__codelineno-0-454"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span>
<a id="__codelineno-0-455" name="__codelineno-0-455" href="#__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456" href="#__codelineno-0-456"></a>    <span class="k">def</span> <span class="nf">_make_running_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunningNorm</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457" href="#__codelineno-0-457"></a>        <span class="c1"># Make a new RunningNorm instance according to the observation tensor.</span>
<a id="__codelineno-0-458" name="__codelineno-0-458" href="#__codelineno-0-458"></a>        <span class="c1"># The dtype and the device of the new RunningNorm is taken from the observation.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459" href="#__codelineno-0-459"></a>        <span class="c1"># This new RunningNorm is empty (i.e. does not contain any stats yet).</span>
<a id="__codelineno-0-460" name="__codelineno-0-460" href="#__codelineno-0-460"></a>        <span class="k">return</span> <span class="n">RunningNorm</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">observation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">observation</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">observation</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461" href="#__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462" href="#__codelineno-0-462"></a>    <span class="k">def</span> <span class="nf">_transfer_running_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">:</span> <span class="n">RunningNorm</span><span class="p">,</span> <span class="n">observation</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunningNorm</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463" href="#__codelineno-0-463"></a>        <span class="c1"># Transfer (if necessary) the RunningNorm to the device of the observation tensor.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464" href="#__codelineno-0-464"></a>        <span class="c1"># The returned RunningNorm may be the RunningNorm itself (if the device did not change)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465" href="#__codelineno-0-465"></a>        <span class="c1"># or a new copy (if the device did change).</span>
<a id="__codelineno-0-466" name="__codelineno-0-466" href="#__codelineno-0-466"></a>        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">rn</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>
<a id="__codelineno-0-467" name="__codelineno-0-467" href="#__codelineno-0-467"></a>            <span class="n">rn</span> <span class="o">=</span> <span class="n">rn</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468" href="#__codelineno-0-468"></a>        <span class="k">return</span> <span class="n">rn</span>
<a id="__codelineno-0-469" name="__codelineno-0-469" href="#__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470" href="#__codelineno-0-470"></a>    <span class="k">def</span> <span class="nf">_normalize_observation</span><span class="p">(</span>
<a id="__codelineno-0-471" name="__codelineno-0-471" href="#__codelineno-0-471"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">update_stats</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-472" name="__codelineno-0-472" href="#__codelineno-0-472"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473" href="#__codelineno-0-473"></a>        <span class="c1"># This function normalizes the received observation batch.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474" href="#__codelineno-0-474"></a>        <span class="c1"># If a mask is given (as a tensor of booleans), only observations with corresponding mask value set as True</span>
<a id="__codelineno-0-475" name="__codelineno-0-475" href="#__codelineno-0-475"></a>        <span class="c1"># will be taken into consideration.</span>
<a id="__codelineno-0-476" name="__codelineno-0-476" href="#__codelineno-0-476"></a>        <span class="c1"># If `update_stats` is given as True and observation normalization is enabled, then we will update the</span>
<a id="__codelineno-0-477" name="__codelineno-0-477" href="#__codelineno-0-477"></a>        <span class="c1"># RunningNorm instances as well.</span>
<a id="__codelineno-0-478" name="__codelineno-0-478" href="#__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479" href="#__codelineno-0-479"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_normalization</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480" href="#__codelineno-0-480"></a>            <span class="c1"># This is the case where observation normalization is enabled.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481" href="#__codelineno-0-481"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482" href="#__codelineno-0-482"></a>                <span class="c1"># If we do not have observation stats yet, we build a new one (according to the dtype and device</span>
<a id="__codelineno-0-483" name="__codelineno-0-483" href="#__codelineno-0-483"></a>                <span class="c1"># of the observation).</span>
<a id="__codelineno-0-484" name="__codelineno-0-484" href="#__codelineno-0-484"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_running_norm</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485" href="#__codelineno-0-485"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486" href="#__codelineno-0-486"></a>                <span class="c1"># If we already have observation stats, we make sure that it is in the correct device.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487" href="#__codelineno-0-487"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transfer_running_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488" href="#__codelineno-0-488"></a>
<a id="__codelineno-0-489" name="__codelineno-0-489" href="#__codelineno-0-489"></a>            <span class="k">if</span> <span class="n">update_stats</span><span class="p">:</span>
<a id="__codelineno-0-490" name="__codelineno-0-490" href="#__codelineno-0-490"></a>                <span class="c1"># This is the case where the `update_stats` argument was encountered as True.</span>
<a id="__codelineno-0-491" name="__codelineno-0-491" href="#__codelineno-0-491"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492" href="#__codelineno-0-492"></a>                    <span class="c1"># If the RunningNorm responsible to collect new stats is not built yet, we build it here</span>
<a id="__codelineno-0-493" name="__codelineno-0-493" href="#__codelineno-0-493"></a>                    <span class="c1"># (according to the dtype and device of the observation).</span>
<a id="__codelineno-0-494" name="__codelineno-0-494" href="#__codelineno-0-494"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_running_norm</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495" href="#__codelineno-0-495"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-496" name="__codelineno-0-496" href="#__codelineno-0-496"></a>                    <span class="c1"># If the RunningNorm responsible to collect new stats already exists, then we make sure</span>
<a id="__codelineno-0-497" name="__codelineno-0-497" href="#__codelineno-0-497"></a>                    <span class="c1"># that it is in the correct device.</span>
<a id="__codelineno-0-498" name="__codelineno-0-498" href="#__codelineno-0-498"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transfer_running_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span>
<a id="__codelineno-0-499" name="__codelineno-0-499" href="#__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500" href="#__codelineno-0-500"></a>                <span class="c1"># We first update the RunningNorm responsible for collecting the new stats.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501" href="#__codelineno-0-501"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502" href="#__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503" href="#__codelineno-0-503"></a>                <span class="c1"># We now update the RunningNorm which stores all the stats, and return the normalized observation.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504" href="#__codelineno-0-504"></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">update_and_normalize</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-505" name="__codelineno-0-505" href="#__codelineno-0-505"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506" href="#__codelineno-0-506"></a>                <span class="c1"># This is the case where the `update_stats` argument was encountered as False.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507" href="#__codelineno-0-507"></a>                <span class="c1"># Here we normalize the observation but do not update our existing RunningNorm instances.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508" href="#__codelineno-0-508"></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509" href="#__codelineno-0-509"></a>            <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-510" name="__codelineno-0-510" href="#__codelineno-0-510"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511" href="#__codelineno-0-511"></a>            <span class="c1"># This is the case where observation normalization is disabled.</span>
<a id="__codelineno-0-512" name="__codelineno-0-512" href="#__codelineno-0-512"></a>            <span class="c1"># In this case, we just return the observation as it is.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513" href="#__codelineno-0-513"></a>            <span class="k">return</span> <span class="n">observation</span>
<a id="__codelineno-0-514" name="__codelineno-0-514" href="#__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515" href="#__codelineno-0-515"></a>    <span class="k">def</span> <span class="nf">_ensure_obsnorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-516" name="__codelineno-0-516" href="#__codelineno-0-516"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span><span class="p">:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517" href="#__codelineno-0-517"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This feature can only be used when observation_normalization=True.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518" href="#__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519" href="#__codelineno-0-519"></a>    <span class="k">def</span> <span class="nf">get_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunningNorm</span><span class="p">:</span>
<a id="__codelineno-0-520" name="__codelineno-0-520" href="#__codelineno-0-520"></a>        <span class="sd">&quot;&quot;&quot;Get the observation stats&quot;&quot;&quot;</span>
<a id="__codelineno-0-521" name="__codelineno-0-521" href="#__codelineno-0-521"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-522" name="__codelineno-0-522" href="#__codelineno-0-522"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span>
<a id="__codelineno-0-523" name="__codelineno-0-523" href="#__codelineno-0-523"></a>
<a id="__codelineno-0-524" name="__codelineno-0-524" href="#__codelineno-0-524"></a>    <span class="k">def</span> <span class="nf">_make_sync_data_for_actors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525" href="#__codelineno-0-525"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span><span class="p">:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526" href="#__codelineno-0-526"></a>            <span class="n">obs_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_observation_stats</span><span class="p">()</span>
<a id="__codelineno-0-527" name="__codelineno-0-527" href="#__codelineno-0-527"></a>            <span class="k">if</span> <span class="n">obs_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528" href="#__codelineno-0-528"></a>                <span class="n">obs_stats</span> <span class="o">=</span> <span class="n">obs_stats</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529" href="#__codelineno-0-529"></a>            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obs_stats</span><span class="o">=</span><span class="n">obs_stats</span><span class="p">)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530" href="#__codelineno-0-530"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-531" name="__codelineno-0-531" href="#__codelineno-0-531"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-532" name="__codelineno-0-532" href="#__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533" href="#__codelineno-0-533"></a>    <span class="k">def</span> <span class="nf">set_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">:</span> <span class="n">RunningNorm</span><span class="p">):</span>
<a id="__codelineno-0-534" name="__codelineno-0-534" href="#__codelineno-0-534"></a>        <span class="sd">&quot;&quot;&quot;Set the observation stats&quot;&quot;&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535" href="#__codelineno-0-535"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-536" name="__codelineno-0-536" href="#__codelineno-0-536"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="o">=</span> <span class="n">rn</span>
<a id="__codelineno-0-537" name="__codelineno-0-537" href="#__codelineno-0-537"></a>
<a id="__codelineno-0-538" name="__codelineno-0-538" href="#__codelineno-0-538"></a>    <span class="k">def</span> <span class="nf">_use_sync_data_from_main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">received</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-539" name="__codelineno-0-539" href="#__codelineno-0-539"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">received</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-540" name="__codelineno-0-540" href="#__codelineno-0-540"></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;obs_stats&quot;</span><span class="p">:</span>
<a id="__codelineno-0-541" name="__codelineno-0-541" href="#__codelineno-0-541"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_observation_stats</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542" href="#__codelineno-0-542"></a>
<a id="__codelineno-0-543" name="__codelineno-0-543" href="#__codelineno-0-543"></a>    <span class="k">def</span> <span class="nf">pop_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunningNorm</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544" href="#__codelineno-0-544"></a>        <span class="sd">&quot;&quot;&quot;Get and clear the collected observation stats&quot;&quot;&quot;</span>
<a id="__codelineno-0-545" name="__codelineno-0-545" href="#__codelineno-0-545"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-546" name="__codelineno-0-546" href="#__codelineno-0-546"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span>
<a id="__codelineno-0-547" name="__codelineno-0-547" href="#__codelineno-0-547"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-548" name="__codelineno-0-548" href="#__codelineno-0-548"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-549" name="__codelineno-0-549" href="#__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550" href="#__codelineno-0-550"></a>    <span class="k">def</span> <span class="nf">_make_sync_data_for_main</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551" href="#__codelineno-0-551"></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">episode_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span><span class="p">,</span> <span class="n">interaction_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span><span class="p">)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552" href="#__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553" href="#__codelineno-0-553"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554" href="#__codelineno-0-554"></a>            <span class="n">collected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_observation_stats</span><span class="p">()</span>
<a id="__codelineno-0-555" name="__codelineno-0-555" href="#__codelineno-0-555"></a>            <span class="k">if</span> <span class="n">collected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-556" name="__codelineno-0-556" href="#__codelineno-0-556"></a>                <span class="n">collected</span> <span class="o">=</span> <span class="n">collected</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557" href="#__codelineno-0-557"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_stats_delta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collected</span>
<a id="__codelineno-0-558" name="__codelineno-0-558" href="#__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559" href="#__codelineno-0-559"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-560" name="__codelineno-0-560" href="#__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561" href="#__codelineno-0-561"></a>    <span class="k">def</span> <span class="nf">update_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">:</span> <span class="n">RunningNorm</span><span class="p">):</span>
<a id="__codelineno-0-562" name="__codelineno-0-562" href="#__codelineno-0-562"></a>        <span class="sd">&quot;&quot;&quot;Update the observation stats via another RunningNorm instance&quot;&quot;&quot;</span>
<a id="__codelineno-0-563" name="__codelineno-0-563" href="#__codelineno-0-563"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-564" name="__codelineno-0-564" href="#__codelineno-0-564"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565" href="#__codelineno-0-565"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="o">=</span> <span class="n">rn</span>
<a id="__codelineno-0-566" name="__codelineno-0-566" href="#__codelineno-0-566"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567" href="#__codelineno-0-567"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rn</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568" href="#__codelineno-0-568"></a>
<a id="__codelineno-0-569" name="__codelineno-0-569" href="#__codelineno-0-569"></a>    <span class="k">def</span> <span class="nf">_use_sync_data_from_actors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">received</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-570" name="__codelineno-0-570" href="#__codelineno-0-570"></a>        <span class="n">total_episode_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-571" name="__codelineno-0-571" href="#__codelineno-0-571"></a>        <span class="n">total_interaction_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-572" name="__codelineno-0-572" href="#__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573" href="#__codelineno-0-573"></a>        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">received</span><span class="p">:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574" href="#__codelineno-0-574"></a>            <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span>
<a id="__codelineno-0-575" name="__codelineno-0-575" href="#__codelineno-0-575"></a>            <span class="n">total_episode_count</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;episode_count&quot;</span><span class="p">]</span>
<a id="__codelineno-0-576" name="__codelineno-0-576" href="#__codelineno-0-576"></a>            <span class="n">total_interaction_count</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;interaction_count&quot;</span><span class="p">]</span>
<a id="__codelineno-0-577" name="__codelineno-0-577" href="#__codelineno-0-577"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578" href="#__codelineno-0-578"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">update_observation_stats</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;obs_stats_delta&quot;</span><span class="p">])</span>
<a id="__codelineno-0-579" name="__codelineno-0-579" href="#__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580" href="#__codelineno-0-580"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_episode_count</span><span class="p">(</span><span class="n">total_episode_count</span><span class="p">)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581" href="#__codelineno-0-581"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_interaction_count</span><span class="p">(</span><span class="n">total_interaction_count</span><span class="p">)</span>
<a id="__codelineno-0-582" name="__codelineno-0-582" href="#__codelineno-0-582"></a>
<a id="__codelineno-0-583" name="__codelineno-0-583" href="#__codelineno-0-583"></a>    <span class="k">def</span> <span class="nf">_make_pickle_data_for_main</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-584" name="__codelineno-0-584" href="#__codelineno-0-584"></a>        <span class="c1"># For when the main Problem object (the non-remote one) gets pickled,</span>
<a id="__codelineno-0-585" name="__codelineno-0-585" href="#__codelineno-0-585"></a>        <span class="c1"># this function returns the counters of this remote Problem instance,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586" href="#__codelineno-0-586"></a>        <span class="c1"># to be sent to the main one.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587" href="#__codelineno-0-587"></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">interaction_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span><span class="p">,</span> <span class="n">episode_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span><span class="p">)</span>
<a id="__codelineno-0-588" name="__codelineno-0-588" href="#__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589" href="#__codelineno-0-589"></a>    <span class="k">def</span> <span class="nf">_use_pickle_data_from_main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-590" name="__codelineno-0-590" href="#__codelineno-0-590"></a>        <span class="c1"># For when a newly unpickled Problem object gets (re)parallelized,</span>
<a id="__codelineno-0-591" name="__codelineno-0-591" href="#__codelineno-0-591"></a>        <span class="c1"># this function restores the inner states specific to this remote</span>
<a id="__codelineno-0-592" name="__codelineno-0-592" href="#__codelineno-0-592"></a>        <span class="c1"># worker. In the case of GymNE, those inner states are episode</span>
<a id="__codelineno-0-593" name="__codelineno-0-593" href="#__codelineno-0-593"></a>        <span class="c1"># and interaction counters.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594" href="#__codelineno-0-594"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-595" name="__codelineno-0-595" href="#__codelineno-0-595"></a>            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;episode_count&quot;</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596" href="#__codelineno-0-596"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_episode_count</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597" href="#__codelineno-0-597"></a>            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;interaction_count&quot;</span><span class="p">:</span>
<a id="__codelineno-0-598" name="__codelineno-0-598" href="#__codelineno-0-598"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_interaction_count</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599" href="#__codelineno-0-599"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600" href="#__codelineno-0-600"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When restoring the inner state of a remote worker, unrecognized state key: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-601" name="__codelineno-0-601" href="#__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602" href="#__codelineno-0-602"></a>    <span class="k">def</span> <span class="nf">_evaluate_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">SolutionBatch</span><span class="p">):</span>
<a id="__codelineno-0-603" name="__codelineno-0-603" href="#__codelineno-0-603"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604" href="#__codelineno-0-604"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subbatch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605" href="#__codelineno-0-605"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606" href="#__codelineno-0-606"></a>            <span class="n">subbatches</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span><span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607" href="#__codelineno-0-607"></a>            <span class="k">for</span> <span class="n">subbatch</span> <span class="ow">in</span> <span class="n">subbatches</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608" href="#__codelineno-0-608"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subbatch</span><span class="p">(</span><span class="n">subbatch</span><span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609" href="#__codelineno-0-609"></a>
<a id="__codelineno-0-610" name="__codelineno-0-610" href="#__codelineno-0-610"></a>    <span class="k">def</span> <span class="nf">_evaluate_subbatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">SolutionBatch</span><span class="p">):</span>
<a id="__codelineno-0-611" name="__codelineno-0-611" href="#__codelineno-0-611"></a>        <span class="c1"># Get the number of solutions and the solution batch from the shape of the batch.</span>
<a id="__codelineno-0-612" name="__codelineno-0-612" href="#__codelineno-0-612"></a>        <span class="n">num_solutions</span><span class="p">,</span> <span class="n">solution_length</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">values_shape</span>
<a id="__codelineno-0-613" name="__codelineno-0-613" href="#__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614" href="#__codelineno-0-614"></a>        <span class="c1"># Get (possibly after (re)building) the environment object.</span>
<a id="__codelineno-0-615" name="__codelineno-0-615" href="#__codelineno-0-615"></a>        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_env</span><span class="p">(</span><span class="n">num_solutions</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616" href="#__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617" href="#__codelineno-0-617"></a>        <span class="c1"># Reset the environment and receive the first observation batch.</span>
<a id="__codelineno-0-618" name="__codelineno-0-618" href="#__codelineno-0-618"></a>        <span class="n">obs_per_env</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-619" name="__codelineno-0-619" href="#__codelineno-0-619"></a>
<a id="__codelineno-0-620" name="__codelineno-0-620" href="#__codelineno-0-620"></a>        <span class="c1"># Update the simulator device according to the device of the observation batch received.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621" href="#__codelineno-0-621"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span> <span class="o">=</span> <span class="n">obs_per_env</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-622" name="__codelineno-0-622" href="#__codelineno-0-622"></a>
<a id="__codelineno-0-623" name="__codelineno-0-623" href="#__codelineno-0-623"></a>        <span class="c1"># Get the number of environments.</span>
<a id="__codelineno-0-624" name="__codelineno-0-624" href="#__codelineno-0-624"></a>        <span class="n">num_envs</span> <span class="o">=</span> <span class="n">obs_per_env</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-625" name="__codelineno-0-625" href="#__codelineno-0-625"></a>
<a id="__codelineno-0-626" name="__codelineno-0-626" href="#__codelineno-0-626"></a>        <span class="c1"># Transfer (if necessary) the solutions (which are the network parameters) to the simulator device.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627" href="#__codelineno-0-627"></a>        <span class="n">batch_values</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628" href="#__codelineno-0-628"></a>
<a id="__codelineno-0-629" name="__codelineno-0-629" href="#__codelineno-0-629"></a>        <span class="k">if</span> <span class="n">num_solutions</span> <span class="o">==</span> <span class="n">num_envs</span><span class="p">:</span>
<a id="__codelineno-0-630" name="__codelineno-0-630" href="#__codelineno-0-630"></a>            <span class="c1"># If the number of solutions is equal to the number of environments, then we declare all of the solutions</span>
<a id="__codelineno-0-631" name="__codelineno-0-631" href="#__codelineno-0-631"></a>            <span class="c1"># as the network parameters, and we declare all of these environments active.</span>
<a id="__codelineno-0-632" name="__codelineno-0-632" href="#__codelineno-0-632"></a>            <span class="n">params_per_env</span> <span class="o">=</span> <span class="n">batch_values</span>
<a id="__codelineno-0-633" name="__codelineno-0-633" href="#__codelineno-0-633"></a>            <span class="n">active_per_env</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_solutions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-634" name="__codelineno-0-634" href="#__codelineno-0-634"></a>        <span class="k">elif</span> <span class="n">num_solutions</span> <span class="o">&lt;</span> <span class="n">num_envs</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635" href="#__codelineno-0-635"></a>            <span class="c1"># If the number of solutions is less than the number of environments, then we allocate a new empty</span>
<a id="__codelineno-0-636" name="__codelineno-0-636" href="#__codelineno-0-636"></a>            <span class="c1"># tensor to represent the network parameters.</span>
<a id="__codelineno-0-637" name="__codelineno-0-637" href="#__codelineno-0-637"></a>            <span class="n">params_per_env</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_envs</span><span class="p">,</span> <span class="n">solution_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-638" name="__codelineno-0-638" href="#__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639" href="#__codelineno-0-639"></a>            <span class="c1"># The first `num_solutions` rows of this new parameters tensor is filled with the values of the solutions.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640" href="#__codelineno-0-640"></a>            <span class="n">params_per_env</span><span class="p">[:</span><span class="n">num_solutions</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">batch_values</span>
<a id="__codelineno-0-641" name="__codelineno-0-641" href="#__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642" href="#__codelineno-0-642"></a>            <span class="c1"># The remaining parameters become the clones of the first solution.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643" href="#__codelineno-0-643"></a>            <span class="n">params_per_env</span><span class="p">[</span><span class="n">num_solutions</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">batch_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644" href="#__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645" href="#__codelineno-0-645"></a>            <span class="c1"># At first, all the environments are declared as inactive.</span>
<a id="__codelineno-0-646" name="__codelineno-0-646" href="#__codelineno-0-646"></a>            <span class="n">active_per_env</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_envs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-647" name="__codelineno-0-647" href="#__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648" href="#__codelineno-0-648"></a>            <span class="c1"># Now, the first `num_solutions` amount of environments is declared as active.</span>
<a id="__codelineno-0-649" name="__codelineno-0-649" href="#__codelineno-0-649"></a>            <span class="c1"># The remaining ones remain inactive.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650" href="#__codelineno-0-650"></a>            <span class="n">active_per_env</span><span class="p">[:</span><span class="n">num_solutions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-651" name="__codelineno-0-651" href="#__codelineno-0-651"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652" href="#__codelineno-0-652"></a>            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Received incompatible number of environments&quot;</span>
<a id="__codelineno-0-653" name="__codelineno-0-653" href="#__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654" href="#__codelineno-0-654"></a>        <span class="c1"># We get the policy and fill it with the parameters stored by the solutions.</span>
<a id="__codelineno-0-655" name="__codelineno-0-655" href="#__codelineno-0-655"></a>        <span class="n">policy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span>
<a id="__codelineno-0-656" name="__codelineno-0-656" href="#__codelineno-0-656"></a>        <span class="n">policy</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">params_per_env</span><span class="p">)</span>
<a id="__codelineno-0-657" name="__codelineno-0-657" href="#__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658" href="#__codelineno-0-658"></a>        <span class="c1"># Declare the counter which stores the total timesteps encountered during this evaluation.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659" href="#__codelineno-0-659"></a>        <span class="n">total_timesteps</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-660" name="__codelineno-0-660" href="#__codelineno-0-660"></a>
<a id="__codelineno-0-661" name="__codelineno-0-661" href="#__codelineno-0-661"></a>        <span class="c1"># Declare the counters (one for each environment) storing the number of episodes completed.</span>
<a id="__codelineno-0-662" name="__codelineno-0-662" href="#__codelineno-0-662"></a>        <span class="n">num_eps_per_env</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_envs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-663" name="__codelineno-0-663" href="#__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664" href="#__codelineno-0-664"></a>        <span class="c1"># Declare the scores (one for each environment).</span>
<a id="__codelineno-0-665" name="__codelineno-0-665" href="#__codelineno-0-665"></a>        <span class="n">score_per_env</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_envs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-666" name="__codelineno-0-666" href="#__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667" href="#__codelineno-0-667"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-668" name="__codelineno-0-668" href="#__codelineno-0-668"></a>            <span class="c1"># If an alive_bonus_schedule was provided, then we extract the timesteps.</span>
<a id="__codelineno-0-669" name="__codelineno-0-669" href="#__codelineno-0-669"></a>            <span class="c1"># bonus_t0 is the timestep where the partial alive bonus will start.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670" href="#__codelineno-0-670"></a>            <span class="c1"># bonus_t1 is the timestep where the full alive bonus will start.</span>
<a id="__codelineno-0-671" name="__codelineno-0-671" href="#__codelineno-0-671"></a>            <span class="c1"># alive_bonus is the amount that will be added to reward if the agent is alive.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672" href="#__codelineno-0-672"></a>            <span class="n">bonus_t0</span><span class="p">,</span> <span class="n">bonus_t1</span><span class="p">,</span> <span class="n">alive_bonus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span>
<a id="__codelineno-0-673" name="__codelineno-0-673" href="#__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674" href="#__codelineno-0-674"></a>            <span class="k">if</span> <span class="n">bonus_t1</span> <span class="o">&gt;</span> <span class="n">bonus_t0</span><span class="p">:</span>
<a id="__codelineno-0-675" name="__codelineno-0-675" href="#__codelineno-0-675"></a>                <span class="c1"># If bonus_t1 is bigger than bonus_t0, then we have a partial alive bonus time window.</span>
<a id="__codelineno-0-676" name="__codelineno-0-676" href="#__codelineno-0-676"></a>                <span class="n">add_partial_alive_bonus</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-677" name="__codelineno-0-677" href="#__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678" href="#__codelineno-0-678"></a>                <span class="c1"># We compute and store the length of the time window.</span>
<a id="__codelineno-0-679" name="__codelineno-0-679" href="#__codelineno-0-679"></a>                <span class="n">bonus_t_gap_as_float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bonus_t1</span> <span class="o">-</span> <span class="n">bonus_t0</span><span class="p">)</span>
<a id="__codelineno-0-680" name="__codelineno-0-680" href="#__codelineno-0-680"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-681" name="__codelineno-0-681" href="#__codelineno-0-681"></a>                <span class="c1"># If bonus_t1 is NOT bigger than bonus_t0, then we do NOT have a partial alive bonus time window.</span>
<a id="__codelineno-0-682" name="__codelineno-0-682" href="#__codelineno-0-682"></a>                <span class="n">add_partial_alive_bonus</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-683" name="__codelineno-0-683" href="#__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684" href="#__codelineno-0-684"></a>            <span class="c1"># To properly give the alive bonus for each solution, we need to keep track of the timesteps for all</span>
<a id="__codelineno-0-685" name="__codelineno-0-685" href="#__codelineno-0-685"></a>            <span class="c1"># the running solutions. So, we declare the following variable.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686" href="#__codelineno-0-686"></a>            <span class="n">t_per_env</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_envs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687" href="#__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688" href="#__codelineno-0-688"></a>        <span class="c1"># We normalize the initial observation.</span>
<a id="__codelineno-0-689" name="__codelineno-0-689" href="#__codelineno-0-689"></a>        <span class="n">obs_per_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_observation</span><span class="p">(</span><span class="n">obs_per_env</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">active_per_env</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690" href="#__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691" href="#__codelineno-0-691"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692" href="#__codelineno-0-692"></a>            <span class="c1"># Pass the observations through the policy and get the actions to perform.</span>
<a id="__codelineno-0-693" name="__codelineno-0-693" href="#__codelineno-0-693"></a>            <span class="n">action_per_env</span> <span class="o">=</span> <span class="n">policy</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">obs_per_env</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">params_per_env</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
<a id="__codelineno-0-694" name="__codelineno-0-694" href="#__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695" href="#__codelineno-0-695"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_noise_stdev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-696" name="__codelineno-0-696" href="#__codelineno-0-696"></a>                <span class="c1"># If we are to apply action noise, we sample from a Gaussian distribution and add the noise onto</span>
<a id="__codelineno-0-697" name="__codelineno-0-697" href="#__codelineno-0-697"></a>                <span class="c1"># the actions.</span>
<a id="__codelineno-0-698" name="__codelineno-0-698" href="#__codelineno-0-698"></a>                <span class="n">action_per_env</span> <span class="o">=</span> <span class="n">action_per_env</span> <span class="o">+</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">action_per_env</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_noise_stdev</span><span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699" href="#__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700" href="#__codelineno-0-700"></a>            <span class="c1"># Apply the actions, get the observations, rewards, and the &#39;done&#39; flags.</span>
<a id="__codelineno-0-701" name="__codelineno-0-701" href="#__codelineno-0-701"></a>            <span class="n">obs_per_env</span><span class="p">,</span> <span class="n">reward_per_env</span><span class="p">,</span> <span class="n">done_per_env</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action_per_env</span><span class="p">)</span>
<a id="__codelineno-0-702" name="__codelineno-0-702" href="#__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703" href="#__codelineno-0-703"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrease_rewards_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-704" name="__codelineno-0-704" href="#__codelineno-0-704"></a>                <span class="c1"># We decrease the rewards, if we have the configuration to do so.</span>
<a id="__codelineno-0-705" name="__codelineno-0-705" href="#__codelineno-0-705"></a>                <span class="n">reward_per_env</span> <span class="o">=</span> <span class="n">reward_per_env</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrease_rewards_by</span>
<a id="__codelineno-0-706" name="__codelineno-0-706" href="#__codelineno-0-706"></a>
<a id="__codelineno-0-707" name="__codelineno-0-707" href="#__codelineno-0-707"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-708" name="__codelineno-0-708" href="#__codelineno-0-708"></a>                <span class="c1"># Here we handle the alive bonus schedule.</span>
<a id="__codelineno-0-709" name="__codelineno-0-709" href="#__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710" href="#__codelineno-0-710"></a>                <span class="c1"># For each environment, increment the timestep.</span>
<a id="__codelineno-0-711" name="__codelineno-0-711" href="#__codelineno-0-711"></a>                <span class="n">t_per_env</span><span class="p">[</span><span class="n">active_per_env</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-712" name="__codelineno-0-712" href="#__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713" href="#__codelineno-0-713"></a>                <span class="c1"># For those who are within the full alive bonus time region, increase the scores by the full amount.</span>
<a id="__codelineno-0-714" name="__codelineno-0-714" href="#__codelineno-0-714"></a>                <span class="n">in_full_bonus_t_per_env</span> <span class="o">=</span> <span class="n">active_per_env</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t_per_env</span> <span class="o">&gt;=</span> <span class="n">bonus_t1</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715" href="#__codelineno-0-715"></a>                <span class="n">score_per_env</span><span class="p">[</span><span class="n">in_full_bonus_t_per_env</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alive_bonus</span>
<a id="__codelineno-0-716" name="__codelineno-0-716" href="#__codelineno-0-716"></a>
<a id="__codelineno-0-717" name="__codelineno-0-717" href="#__codelineno-0-717"></a>                <span class="k">if</span> <span class="n">add_partial_alive_bonus</span><span class="p">:</span>
<a id="__codelineno-0-718" name="__codelineno-0-718" href="#__codelineno-0-718"></a>                    <span class="c1"># Here we handle the partial alive bonus time window.</span>
<a id="__codelineno-0-719" name="__codelineno-0-719" href="#__codelineno-0-719"></a>                    <span class="c1"># We first determine which environments are in the partial alive bonus time window.</span>
<a id="__codelineno-0-720" name="__codelineno-0-720" href="#__codelineno-0-720"></a>                    <span class="n">in_partial_bonus_t_per_env</span> <span class="o">=</span> <span class="n">active_per_env</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t_per_env</span> <span class="o">&gt;=</span> <span class="n">bonus_t0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t_per_env</span> <span class="o">&lt;</span> <span class="n">bonus_t1</span><span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721" href="#__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722" href="#__codelineno-0-722"></a>                    <span class="c1"># Here we compute the partial alive bonuses and add those bonuses to the scores.</span>
<a id="__codelineno-0-723" name="__codelineno-0-723" href="#__codelineno-0-723"></a>                    <span class="n">score_per_env</span><span class="p">[</span><span class="n">in_partial_bonus_t_per_env</span><span class="p">]</span> <span class="o">+=</span> <span class="n">alive_bonus</span> <span class="o">*</span> <span class="p">(</span>
<a id="__codelineno-0-724" name="__codelineno-0-724" href="#__codelineno-0-724"></a>                        <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">t_per_env</span><span class="p">[</span><span class="n">in_partial_bonus_t_per_env</span><span class="p">]</span> <span class="o">-</span> <span class="n">bonus_t0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725" href="#__codelineno-0-725"></a>                        <span class="o">/</span> <span class="n">bonus_t_gap_as_float</span>
<a id="__codelineno-0-726" name="__codelineno-0-726" href="#__codelineno-0-726"></a>                    <span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727" href="#__codelineno-0-727"></a>
<a id="__codelineno-0-728" name="__codelineno-0-728" href="#__codelineno-0-728"></a>                <span class="c1"># Determine which environments just finished their episodes.</span>
<a id="__codelineno-0-729" name="__codelineno-0-729" href="#__codelineno-0-729"></a>                <span class="n">just_finished_per_env</span> <span class="o">=</span> <span class="n">active_per_env</span> <span class="o">&amp;</span> <span class="n">done_per_env</span>
<a id="__codelineno-0-730" name="__codelineno-0-730" href="#__codelineno-0-730"></a>
<a id="__codelineno-0-731" name="__codelineno-0-731" href="#__codelineno-0-731"></a>                <span class="c1"># Reset the timestep counters of the environments which are just finished.</span>
<a id="__codelineno-0-732" name="__codelineno-0-732" href="#__codelineno-0-732"></a>                <span class="n">t_per_env</span><span class="p">[</span><span class="n">just_finished_per_env</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-733" name="__codelineno-0-733" href="#__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734" href="#__codelineno-0-734"></a>            <span class="c1"># For each active environment, increase the score by the reward received.</span>
<a id="__codelineno-0-735" name="__codelineno-0-735" href="#__codelineno-0-735"></a>            <span class="n">score_per_env</span><span class="p">[</span><span class="n">active_per_env</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward_per_env</span><span class="p">[</span><span class="n">active_per_env</span><span class="p">]</span>
<a id="__codelineno-0-736" name="__codelineno-0-736" href="#__codelineno-0-736"></a>
<a id="__codelineno-0-737" name="__codelineno-0-737" href="#__codelineno-0-737"></a>            <span class="c1"># Update the total timesteps counter.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738" href="#__codelineno-0-738"></a>            <span class="n">total_timesteps</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">active_per_env</span><span class="p">))</span>
<a id="__codelineno-0-739" name="__codelineno-0-739" href="#__codelineno-0-739"></a>
<a id="__codelineno-0-740" name="__codelineno-0-740" href="#__codelineno-0-740"></a>            <span class="c1"># Reset the policies whose episodes are done (so that their hidden states become 0).</span>
<a id="__codelineno-0-741" name="__codelineno-0-741" href="#__codelineno-0-741"></a>            <span class="n">policy</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">done_per_env</span><span class="p">)</span>
<a id="__codelineno-0-742" name="__codelineno-0-742" href="#__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743" href="#__codelineno-0-743"></a>            <span class="c1"># Update the number of episodes counter for each environment.</span>
<a id="__codelineno-0-744" name="__codelineno-0-744" href="#__codelineno-0-744"></a>            <span class="n">num_eps_per_env</span><span class="p">[</span><span class="n">done_per_env</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-745" name="__codelineno-0-745" href="#__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746" href="#__codelineno-0-746"></a>            <span class="c1"># Solutions with number of completed episodes larger than the number of allowed episodes become inactive.</span>
<a id="__codelineno-0-747" name="__codelineno-0-747" href="#__codelineno-0-747"></a>            <span class="n">active_per_env</span><span class="p">[:</span><span class="n">num_solutions</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_eps_per_env</span><span class="p">[:</span><span class="n">num_solutions</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_episodes</span>
<a id="__codelineno-0-748" name="__codelineno-0-748" href="#__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749" href="#__codelineno-0-749"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">active_per_env</span><span class="p">[:</span><span class="n">num_solutions</span><span class="p">]):</span>
<a id="__codelineno-0-750" name="__codelineno-0-750" href="#__codelineno-0-750"></a>                <span class="c1"># If there is not a single active solution left, then we exit this loop.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751" href="#__codelineno-0-751"></a>                <span class="k">break</span>
<a id="__codelineno-0-752" name="__codelineno-0-752" href="#__codelineno-0-752"></a>
<a id="__codelineno-0-753" name="__codelineno-0-753" href="#__codelineno-0-753"></a>            <span class="c1"># For the next iteration of this loop, we normalize the observation.</span>
<a id="__codelineno-0-754" name="__codelineno-0-754" href="#__codelineno-0-754"></a>            <span class="n">obs_per_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_observation</span><span class="p">(</span><span class="n">obs_per_env</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">active_per_env</span><span class="p">)</span>
<a id="__codelineno-0-755" name="__codelineno-0-755" href="#__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756" href="#__codelineno-0-756"></a>        <span class="c1"># Update the interaction count and the episode count stored by this VecGymNE instance.</span>
<a id="__codelineno-0-757" name="__codelineno-0-757" href="#__codelineno-0-757"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_count</span> <span class="o">+=</span> <span class="n">total_timesteps</span>
<a id="__codelineno-0-758" name="__codelineno-0-758" href="#__codelineno-0-758"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span> <span class="o">+=</span> <span class="n">num_solutions</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_episodes</span>
<a id="__codelineno-0-759" name="__codelineno-0-759" href="#__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760" href="#__codelineno-0-760"></a>        <span class="c1"># Compute the fitnesses</span>
<a id="__codelineno-0-761" name="__codelineno-0-761" href="#__codelineno-0-761"></a>        <span class="n">fitnesses</span> <span class="o">=</span> <span class="n">score_per_env</span><span class="p">[:</span><span class="n">num_solutions</span><span class="p">]</span>
<a id="__codelineno-0-762" name="__codelineno-0-762" href="#__codelineno-0-762"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_episodes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763" href="#__codelineno-0-763"></a>            <span class="n">fitnesses</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_episodes</span>
<a id="__codelineno-0-764" name="__codelineno-0-764" href="#__codelineno-0-764"></a>
<a id="__codelineno-0-765" name="__codelineno-0-765" href="#__codelineno-0-765"></a>        <span class="c1"># Assign the scores to the solutions as fitnesses.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766" href="#__codelineno-0-766"></a>        <span class="n">batch</span><span class="o">.</span><span class="n">set_evals</span><span class="p">(</span><span class="n">fitnesses</span><span class="p">)</span>
<a id="__codelineno-0-767" name="__codelineno-0-767" href="#__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768" href="#__codelineno-0-768"></a>    <span class="k">def</span> <span class="nf">get_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">]:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769" href="#__codelineno-0-769"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-770" name="__codelineno-0-770" href="#__codelineno-0-770"></a><span class="sd">        Get the gym environment.</span>
<a id="__codelineno-0-771" name="__codelineno-0-771" href="#__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772" href="#__codelineno-0-772"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-773" name="__codelineno-0-773" href="#__codelineno-0-773"></a><span class="sd">            The gym environment if it is built. If not built yet, None.</span>
<a id="__codelineno-0-774" name="__codelineno-0-774" href="#__codelineno-0-774"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775" href="#__codelineno-0-775"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span>
<a id="__codelineno-0-776" name="__codelineno-0-776" href="#__codelineno-0-776"></a>
<a id="__codelineno-0-777" name="__codelineno-0-777" href="#__codelineno-0-777"></a>    <span class="k">def</span> <span class="nf">to_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_wrapper_modules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span>
<a id="__codelineno-0-778" name="__codelineno-0-778" href="#__codelineno-0-778"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-779" name="__codelineno-0-779" href="#__codelineno-0-779"></a><span class="sd">        Convert the given solution to a policy.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780" href="#__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781" href="#__codelineno-0-781"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782" href="#__codelineno-0-782"></a><span class="sd">            solution: A solution which can be given as a `torch.Tensor`, as a</span>
<a id="__codelineno-0-783" name="__codelineno-0-783" href="#__codelineno-0-783"></a><span class="sd">                `Solution`, or as any `Iterable`.</span>
<a id="__codelineno-0-784" name="__codelineno-0-784" href="#__codelineno-0-784"></a><span class="sd">            with_wrapper_modules: Whether or not to wrap the policy module</span>
<a id="__codelineno-0-785" name="__codelineno-0-785" href="#__codelineno-0-785"></a><span class="sd">                with helper modules so that observations are normalized</span>
<a id="__codelineno-0-786" name="__codelineno-0-786" href="#__codelineno-0-786"></a><span class="sd">                and actions are clipped to be within the correct boundaries.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787" href="#__codelineno-0-787"></a><span class="sd">                The default and the recommended value is True.</span>
<a id="__codelineno-0-788" name="__codelineno-0-788" href="#__codelineno-0-788"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789" href="#__codelineno-0-789"></a><span class="sd">            The policy, as a `torch.nn.Module` instance.</span>
<a id="__codelineno-0-790" name="__codelineno-0-790" href="#__codelineno-0-790"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791" href="#__codelineno-0-791"></a>        <span class="c1"># Get the gym environment</span>
<a id="__codelineno-0-792" name="__codelineno-0-792" href="#__codelineno-0-792"></a>        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_env</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793" href="#__codelineno-0-793"></a>
<a id="__codelineno-0-794" name="__codelineno-0-794" href="#__codelineno-0-794"></a>        <span class="c1"># Get the observation space, its lower and higher bounds.</span>
<a id="__codelineno-0-795" name="__codelineno-0-795" href="#__codelineno-0-795"></a>        <span class="n">obs_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">single_action_space</span>
<a id="__codelineno-0-796" name="__codelineno-0-796" href="#__codelineno-0-796"></a>        <span class="n">low</span> <span class="o">=</span> <span class="n">obs_space</span><span class="o">.</span><span class="n">low</span>
<a id="__codelineno-0-797" name="__codelineno-0-797" href="#__codelineno-0-797"></a>        <span class="n">high</span> <span class="o">=</span> <span class="n">obs_space</span><span class="o">.</span><span class="n">high</span>
<a id="__codelineno-0-798" name="__codelineno-0-798" href="#__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799" href="#__codelineno-0-799"></a>        <span class="c1"># If the lower and higher bounds are not -inf and +inf respectively, then this environment needs clipping.</span>
<a id="__codelineno-0-800" name="__codelineno-0-800" href="#__codelineno-0-800"></a>        <span class="n">needs_clipping</span> <span class="o">=</span> <span class="n">_numpy_arrays_specify_bounds</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801" href="#__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802" href="#__codelineno-0-802"></a>        <span class="c1"># Convert the solution to a PyTorch tensor on cpu.</span>
<a id="__codelineno-0-803" name="__codelineno-0-803" href="#__codelineno-0-803"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-804" name="__codelineno-0-804" href="#__codelineno-0-804"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805" href="#__codelineno-0-805"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">Solution</span><span class="p">):</span>
<a id="__codelineno-0-806" name="__codelineno-0-806" href="#__codelineno-0-806"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807" href="#__codelineno-0-807"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-808" name="__codelineno-0-808" href="#__codelineno-0-808"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-809" name="__codelineno-0-809" href="#__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810" href="#__codelineno-0-810"></a>        <span class="c1"># Convert the internally stored policy to a PyTorch module.</span>
<a id="__codelineno-0-811" name="__codelineno-0-811" href="#__codelineno-0-811"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">to_torch_module</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
<a id="__codelineno-0-812" name="__codelineno-0-812" href="#__codelineno-0-812"></a>
<a id="__codelineno-0-813" name="__codelineno-0-813" href="#__codelineno-0-813"></a>        <span class="k">if</span> <span class="n">with_wrapper_modules</span><span class="p">:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814" href="#__codelineno-0-814"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-815" name="__codelineno-0-815" href="#__codelineno-0-815"></a>                <span class="c1"># If observation normalization is needed and there are collected observation stats, then we wrap the</span>
<a id="__codelineno-0-816" name="__codelineno-0-816" href="#__codelineno-0-816"></a>                <span class="c1"># policy with an ObsNormWrapperModule.</span>
<a id="__codelineno-0-817" name="__codelineno-0-817" href="#__codelineno-0-817"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">ObsNormWrapperModule</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818" href="#__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819" href="#__codelineno-0-819"></a>            <span class="k">if</span> <span class="n">needs_clipping</span><span class="p">:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820" href="#__codelineno-0-820"></a>                <span class="c1"># If clipping is needed, then we wrap the policy with an ActClipWrapperModule</span>
<a id="__codelineno-0-821" name="__codelineno-0-821" href="#__codelineno-0-821"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">ActClipWrapperModule</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">obs_space</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822" href="#__codelineno-0-822"></a>
<a id="__codelineno-0-823" name="__codelineno-0-823" href="#__codelineno-0-823"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-824" name="__codelineno-0-824" href="#__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825" href="#__codelineno-0-825"></a>    <span class="k">def</span> <span class="nf">save_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
<a id="__codelineno-0-826" name="__codelineno-0-826" href="#__codelineno-0-826"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-827" name="__codelineno-0-827" href="#__codelineno-0-827"></a><span class="sd">        Save the solution into a pickle file.</span>
<a id="__codelineno-0-828" name="__codelineno-0-828" href="#__codelineno-0-828"></a><span class="sd">        Among the saved data within the pickle file are the solution</span>
<a id="__codelineno-0-829" name="__codelineno-0-829" href="#__codelineno-0-829"></a><span class="sd">        (as a PyTorch tensor), the policy (as a `torch.nn.Module` instance),</span>
<a id="__codelineno-0-830" name="__codelineno-0-830" href="#__codelineno-0-830"></a><span class="sd">        and observation stats (if any).</span>
<a id="__codelineno-0-831" name="__codelineno-0-831" href="#__codelineno-0-831"></a>
<a id="__codelineno-0-832" name="__codelineno-0-832" href="#__codelineno-0-832"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-833" name="__codelineno-0-833" href="#__codelineno-0-833"></a><span class="sd">            solution: The solution to be saved. This can be a PyTorch tensor,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834" href="#__codelineno-0-834"></a><span class="sd">                a `Solution` instance, or any `Iterable`.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835" href="#__codelineno-0-835"></a><span class="sd">            fname: The file name of the pickle file to be created.</span>
<a id="__codelineno-0-836" name="__codelineno-0-836" href="#__codelineno-0-836"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-837" name="__codelineno-0-837" href="#__codelineno-0-837"></a>
<a id="__codelineno-0-838" name="__codelineno-0-838" href="#__codelineno-0-838"></a>        <span class="c1"># Convert the solution to a PyTorch tensor on the cpu.</span>
<a id="__codelineno-0-839" name="__codelineno-0-839" href="#__codelineno-0-839"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-840" name="__codelineno-0-840" href="#__codelineno-0-840"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-841" name="__codelineno-0-841" href="#__codelineno-0-841"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">Solution</span><span class="p">):</span>
<a id="__codelineno-0-842" name="__codelineno-0-842" href="#__codelineno-0-842"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843" href="#__codelineno-0-843"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-844" name="__codelineno-0-844" href="#__codelineno-0-844"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845" href="#__codelineno-0-845"></a>
<a id="__codelineno-0-846" name="__codelineno-0-846" href="#__codelineno-0-846"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">ReadOnlyTensor</span><span class="p">):</span>
<a id="__codelineno-0-847" name="__codelineno-0-847" href="#__codelineno-0-847"></a>            <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">as_subclass</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
<a id="__codelineno-0-848" name="__codelineno-0-848" href="#__codelineno-0-848"></a>
<a id="__codelineno-0-849" name="__codelineno-0-849" href="#__codelineno-0-849"></a>        <span class="c1"># Store the solution and the policy.</span>
<a id="__codelineno-0-850" name="__codelineno-0-850" href="#__codelineno-0-850"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-851" name="__codelineno-0-851" href="#__codelineno-0-851"></a>            <span class="s2">&quot;solution&quot;</span><span class="p">:</span> <span class="n">solution</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852" href="#__codelineno-0-852"></a>            <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_policy</span><span class="p">(</span><span class="n">solution</span><span class="p">),</span>
<a id="__codelineno-0-853" name="__codelineno-0-853" href="#__codelineno-0-853"></a>        <span class="p">}</span>
<a id="__codelineno-0-854" name="__codelineno-0-854" href="#__codelineno-0-854"></a>
<a id="__codelineno-0-855" name="__codelineno-0-855" href="#__codelineno-0-855"></a>        <span class="c1"># If available, store the observation stats.</span>
<a id="__codelineno-0-856" name="__codelineno-0-856" href="#__codelineno-0-856"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-857" name="__codelineno-0-857" href="#__codelineno-0-857"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858" href="#__codelineno-0-858"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">stdev</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-859" name="__codelineno-0-859" href="#__codelineno-0-859"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860" href="#__codelineno-0-860"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_sum_of_squares&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">sum_of_squares</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861" href="#__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862" href="#__codelineno-0-862"></a>        <span class="c1"># Some additional data.</span>
<a id="__codelineno-0-863" name="__codelineno-0-863" href="#__codelineno-0-863"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;interaction_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span>
<a id="__codelineno-0-864" name="__codelineno-0-864" href="#__codelineno-0-864"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;episode_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span>
<a id="__codelineno-0-865" name="__codelineno-0-865" href="#__codelineno-0-865"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-866" name="__codelineno-0-866" href="#__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867" href="#__codelineno-0-867"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-868" name="__codelineno-0-868" href="#__codelineno-0-868"></a>            <span class="c1"># If the environment was specified via a string, store the string.</span>
<a id="__codelineno-0-869" name="__codelineno-0-869" href="#__codelineno-0-869"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span>
<a id="__codelineno-0-870" name="__codelineno-0-870" href="#__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871" href="#__codelineno-0-871"></a>        <span class="c1"># Store the network architecture.</span>
<a id="__codelineno-0-872" name="__codelineno-0-872" href="#__codelineno-0-872"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;architecture&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_architecture</span>
<a id="__codelineno-0-873" name="__codelineno-0-873" href="#__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874" href="#__codelineno-0-874"></a>        <span class="c1"># Save the dictionary which stores the data.</span>
<a id="__codelineno-0-875" name="__codelineno-0-875" href="#__codelineno-0-875"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-876" name="__codelineno-0-876" href="#__codelineno-0-876"></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877" href="#__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878" href="#__codelineno-0-878"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-879" name="__codelineno-0-879" href="#__codelineno-0-879"></a>    <span class="k">def</span> <span class="nf">max_num_envs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-880" name="__codelineno-0-880" href="#__codelineno-0-880"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-881" name="__codelineno-0-881" href="#__codelineno-0-881"></a><span class="sd">        Maximum number of environments to be allocated.</span>
<a id="__codelineno-0-882" name="__codelineno-0-882" href="#__codelineno-0-882"></a>
<a id="__codelineno-0-883" name="__codelineno-0-883" href="#__codelineno-0-883"></a><span class="sd">        If a maximum number of environments is not set, then None is returned.</span>
<a id="__codelineno-0-884" name="__codelineno-0-884" href="#__codelineno-0-884"></a><span class="sd">        If this problem instance is the main one, then the overall maximum</span>
<a id="__codelineno-0-885" name="__codelineno-0-885" href="#__codelineno-0-885"></a><span class="sd">        number of environments is returned.</span>
<a id="__codelineno-0-886" name="__codelineno-0-886" href="#__codelineno-0-886"></a><span class="sd">        If this problem instance is a remote one (i.e. is on a remote actor)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887" href="#__codelineno-0-887"></a><span class="sd">        then the maximum number of environments for that actor is returned.</span>
<a id="__codelineno-0-888" name="__codelineno-0-888" href="#__codelineno-0-888"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-889" name="__codelineno-0-889" href="#__codelineno-0-889"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890" href="#__codelineno-0-890"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_num_envs</span>
<a id="__codelineno-0-891" name="__codelineno-0-891" href="#__codelineno-0-891"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-892" name="__codelineno-0-892" href="#__codelineno-0-892"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span>
<a id="__codelineno-0-893" name="__codelineno-0-893" href="#__codelineno-0-893"></a>
<a id="__codelineno-0-894" name="__codelineno-0-894" href="#__codelineno-0-894"></a>    <span class="k">def</span> <span class="nf">make_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span>
<a id="__codelineno-0-895" name="__codelineno-0-895" href="#__codelineno-0-895"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-896" name="__codelineno-0-896" href="#__codelineno-0-896"></a><span class="sd">        Make a new policy network parameterized by the given solution.</span>
<a id="__codelineno-0-897" name="__codelineno-0-897" href="#__codelineno-0-897"></a><span class="sd">        Note that this parameterized network assumes that the observation</span>
<a id="__codelineno-0-898" name="__codelineno-0-898" href="#__codelineno-0-898"></a><span class="sd">        is already normalized, and it does not do action clipping to ensure</span>
<a id="__codelineno-0-899" name="__codelineno-0-899" href="#__codelineno-0-899"></a><span class="sd">        that the generated actions are within valid bounds.</span>
<a id="__codelineno-0-900" name="__codelineno-0-900" href="#__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901" href="#__codelineno-0-901"></a><span class="sd">        To have a policy network which has its own observation normalization</span>
<a id="__codelineno-0-902" name="__codelineno-0-902" href="#__codelineno-0-902"></a><span class="sd">        and action clipping layers, please see the method `to_policy(...)`.</span>
<a id="__codelineno-0-903" name="__codelineno-0-903" href="#__codelineno-0-903"></a>
<a id="__codelineno-0-904" name="__codelineno-0-904" href="#__codelineno-0-904"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905" href="#__codelineno-0-905"></a><span class="sd">            solution: The solution which stores the parameters.</span>
<a id="__codelineno-0-906" name="__codelineno-0-906" href="#__codelineno-0-906"></a><span class="sd">                This can be a Solution instance, or a 1-dimensional tensor,</span>
<a id="__codelineno-0-907" name="__codelineno-0-907" href="#__codelineno-0-907"></a><span class="sd">                or any Iterable of real numbers.</span>
<a id="__codelineno-0-908" name="__codelineno-0-908" href="#__codelineno-0-908"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-909" name="__codelineno-0-909" href="#__codelineno-0-909"></a><span class="sd">            The policy network, as a PyTorch module.</span>
<a id="__codelineno-0-910" name="__codelineno-0-910" href="#__codelineno-0-910"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-911" name="__codelineno-0-911" href="#__codelineno-0-911"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_policy</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">with_wrapper_modules</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912" href="#__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913" href="#__codelineno-0-913"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-914" name="__codelineno-0-914" href="#__codelineno-0-914"></a>    <span class="k">def</span> <span class="nf">network_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915" href="#__codelineno-0-915"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-916" name="__codelineno-0-916" href="#__codelineno-0-916"></a><span class="sd">        The device on which the policy networks will operate.</span>
<a id="__codelineno-0-917" name="__codelineno-0-917" href="#__codelineno-0-917"></a>
<a id="__codelineno-0-918" name="__codelineno-0-918" href="#__codelineno-0-918"></a><span class="sd">        Specific to VecGymNE, the network device is determined only</span>
<a id="__codelineno-0-919" name="__codelineno-0-919" href="#__codelineno-0-919"></a><span class="sd">        after receiving the first observation from the reinforcement</span>
<a id="__codelineno-0-920" name="__codelineno-0-920" href="#__codelineno-0-920"></a><span class="sd">        learning environment. Until then, this property has the value</span>
<a id="__codelineno-0-921" name="__codelineno-0-921" href="#__codelineno-0-921"></a><span class="sd">        None.</span>
<a id="__codelineno-0-922" name="__codelineno-0-922" href="#__codelineno-0-922"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-923" name="__codelineno-0-923" href="#__codelineno-0-923"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.episode_count" class="doc doc-heading">
<code class="highlight language-python"><span class="n">episode_count</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.episode_count" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the total number of episodes completed.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.interaction_count" class="doc doc-heading">
<code class="highlight language-python"><span class="n">interaction_count</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.interaction_count" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the total number of simulator interactions made.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.max_num_envs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.max_num_envs" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Maximum number of environments to be allocated.</p>
<p>If a maximum number of environments is not set, then None is returned.
If this problem instance is the main one, then the overall maximum
number of environments is returned.
If this problem instance is a remote one (i.e. is on a remote actor)
then the maximum number of environments for that actor is returned.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.network_device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network_device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.network_device" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>The device on which the policy networks will operate.</p>
<p>Specific to VecGymNE, the network device is determined only
after receiving the first observation from the reinforcement
learning environment. Until then, this property has the value
None.</p>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">env_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_num_envs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">network_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation_normalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">decrease_rewards_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alive_bonus_schedule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action_noise_stdev</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_episodes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_actors</span><span class="o">=</span><span class="s1">&#39;num_devices&#39;</span><span class="p">,</span> <span class="n">num_gpus_per_actor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_subbatches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subbatch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">actor_config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.__init__" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Initialize the VecGymNE.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>env</code></td>
        <td><code>Union[str, Callable]</code></td>
        <td><p>Environment to be solved.
If this is given as a string starting with "gym::" (e.g.
"gym::Humanoid-v4", etc.), then it is assumed that the target
environment is a classical gym environment.
If this is given as a string starting with "brax::" (e.g.
"brax::humanoid", etc.), then it is assumed that the target
environment is a brax environment.
If this is given as a string which does not contain "::" at
all (e.g. "Humanoid-v4", etc.), then it is assumed that the
target environment is a classical gym environment. Therefore,
"gym::Humanoid-v4" and "Humanoid-v4" are equivalent.
If this argument is given as a Callable (maybe a function or a
class), then, with the assumption that this Callable expects
a keyword argument <code>num_envs: int</code>, this Callable is called
and its result (expected as a <code>gym.vector.VectorEnv</code> instance)
is used as the environment.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>network</code></td>
        <td><code>Union[str, Callable, torch.nn.modules.module.Module]</code></td>
        <td><p>A network structure string, or a Callable (which can be
a class inheriting from <code>torch.nn.Module</code>, or a function
which returns a <code>torch.nn.Module</code> instance), or an instance
of <code>torch.nn.Module</code>.
The object provided here determines the structure of the
neural network whose parameters will be evolved.
A network structure string is a string which can be processed
by <code>evotorch.neuroevolution.net.str_to_net(...)</code>.
Please see the documentation of the function
<code>evotorch.neuroevolution.net.str_to_net(...)</code> to see how such
a neural network structure string looks like.
Note that this network can be a recurrent network.
When the network's <code>forward(...)</code> method can optionally accept
an additional positional argument for the hidden state of the
network and returns an additional value for its next state,
then the policy is treated as a recurrent one.
When the network is given as a callable object (e.g.
a subclass of <code>nn.Module</code> or a function) and this callable
object is decorated via <code>evotorch.decorators.pass_info</code>,
the following keyword arguments will be passed:
(i) <code>obs_length</code> (the length of the observation vector),
(ii) <code>act_length</code> (the length of the action vector),
(iii) <code>obs_shape</code> (the shape tuple of the observation space),
(iv) <code>act_shape</code> (the shape tuple of the action space),
(v) <code>obs_space</code> (the Box object specifying the observation
space, and
(vi) <code>act_space</code> (the Box object specifying the action
space). Note that <code>act_space</code> will always be given as a
<code>gym.spaces.Box</code> instance, even when the actual gym
environment has a discrete action space. This because
<code>VecGymNE</code> always expects the neural network to return
a tensor of floating-point numbers.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>env_config</code></td>
        <td><code>Optional[collections.abc.Mapping]</code></td>
        <td><p>Keyword arguments to pass to the environment while
it is being created.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>max_num_envs</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Maximum number of environments to be instantiated.
By default, this is None, which means that the number of
environments can go up to the population size (or up to the
number of solutions that a remote actor receives, if the
problem object is configured to have parallelization).
For situations where the current reinforcement learning task
requires large amount of resources (e.g. memory), allocating
environments as much as the number of solutions might not
be feasible. In such cases, one can set <code>max_num_envs</code> as an
integer to bring an upper bound (in total, across all the
remote actors, for when the problem is parallelized) to how
many environments can be allocated.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>network_args</code></td>
        <td><code>Optional[collections.abc.Mapping]</code></td>
        <td><p>Any additional keyword argument to be used when
instantiating the network can be specified via <code>network_args</code>
as a dictionary. If there are no such additional keyword
arguments, then <code>network_args</code> can be left as None.
Note that the argument <code>network_args</code> is expected to be None
when the network is specified as a <code>torch.nn.Module</code> instance.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>observation_normalization</code></td>
        <td><code>bool</code></td>
        <td><p>Whether or not online normalization
will be done on the encountered observations.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>decrease_rewards_by</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>If given as a float, each reward will be
decreased by this amount. For example, if the environment's
reward function has a constant "alive bonus" (i.e. a bonus
that is constantly added onto the reward as long as the
agent is alive), and if you wish to negate this bonus,
you can set <code>decrease_rewards_by</code> to this bonus amount,
and the bonus will be nullified.
If you do not wish to affect the rewards in this manner,
keep this as None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>alive_bonus_schedule</code></td>
        <td><code>Optional[tuple]</code></td>
        <td><p>Use this to add a customized amount of
alive bonus.
If left as None (which is the default), additional alive
bonus will not be added.
If given as a tuple <code>(t, b)</code>, an alive bonus <code>b</code> will be
added onto all the rewards beyond the timestep <code>t</code>.
If given as a tuple <code>(t0, t1, b)</code>, a partial (linearly
increasing towards <code>b</code>) alive bonus will be added onto
all the rewards between the timesteps <code>t0</code> and <code>t1</code>,
and a full alive bonus (which equals to <code>b</code>) will be added
onto all the rewards beyond the timestep <code>t1</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>action_noise_stdev</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>If given as a real number <code>s</code>, then, for
each generated action, Gaussian noise with standard
deviation <code>s</code> will be sampled, and then this sampled noise
will be added onto the action.
If action noise is not desired, then this argument can be
left as None.
For sampling the noise, the global random number generator
of PyTorch on the simulator's device will be used.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>num_episodes</code></td>
        <td><code>int</code></td>
        <td><p>Number of episodes over which each policy will
be evaluated. The default is 1.</p></td>
        <td><code>1</code></td>
      </tr>
      <tr>
        <td><code>device</code></td>
        <td><code>Union[str, torch.device]</code></td>
        <td><p>The device in which the population will be kept.
If you wish to do a single-GPU evolution, we recommend
to set this as "cuda" (or "cuda:0", or "cuda:1", etc.),
assuming that the simulator will also instantiate itself
on that same device.
Alternatively, if you wish to do a multi-GPU evolution,
we recommend to leave this as None or set this as "cpu",
so that the main population will be kept on the cpu
and the remote actors will perform their evaluations on
the GPUs that are assigned to them.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>num_actors</code></td>
        <td><code>Union[int, str]</code></td>
        <td><p>Number of actors.
This is, by default, "num_devices" which creates multiple
actors in such a way that each actor will be assigned
an entire GPU.
This default setting considers the multi-GPU scenario
(and requires multiple GPUs to work correctly).
If you wish to perform the entire evolution on a single
GPU, we recommend to set <code>num_actors</code> as 0 (so that there
will be no remote actors) and set <code>device</code> as "cuda"
(or "cuda:0", or "cuda:1", etc., the device in which the
simulator will be instantiated).
If you do not have any GPUs the special value "num_devices"
will allocate n actors, n being the number of CPUs.
You can also set <code>num_actors</code> as an integer to determine
the exact number of subprocesses which will evaluate the
solutions in parallel. Note that, however, when you set
<code>num_actors</code> as an integer, you will also have to explicitly
specify the number of GPUs each actor will be assigned
via the argument <code>num_gpus_per_actor</code>.</p></td>
        <td><code>&#39;num_devices&#39;</code></td>
      </tr>
      <tr>
        <td><code>num_gpus_per_actor</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Number of GPUs to be assigned to each
actor. This can be an integer or a float (for when you
wish to assign fractional amounts of GPUs to actors).
When <code>num_actors</code> has the special value "num_devices",
the argument <code>num_gpus_per_actor</code> is expected to be left as
None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>num_subbatches</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>For when there are multiple actors, you can
set this to an integer n if you wish the population
to be divided exactly into n sub-batches. The actors, as they
finish their currently assigned sub-batch of solutions,
will pick the next un-evaluated sub-batch.
If you specify too large numbers for this argument, then
each sub-batch will be smaller.
When working with vectorized simulators on GPU, having too
many and too small sub-batches can hurt the performance.
This argument can be left as None, in which case, assuming
that <code>subbatch_size</code> is also None, the population will be
split to m sub-batches, m being the number of actors.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>subbatch_size</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>For when there are multiple actors, you can
set this to an integer n if you wish the population to be
divided into sub-batches in such a way that each sub-batch
will consist of exactly n solutions. The actors, as they
finish their currently assigned sub-batch of solutions,
will pick the next un-evaluated sub-batch.
If you specify too small numbers for this argument, then
there will be many sub-batches, each sub-batch having a
small number of solutions.
When working with vectorized simulators on GPU, having too
many and too small sub-batches can hurt the performance.
This argument can be left as None, in which case, assuming
that <code>num_subbatches</code> is also None, the population will be
split to m sub-batches, m being the number of actors.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>actor_config</code></td>
        <td><code>Optional[collections.abc.Mapping]</code></td>
        <td><p>Additional configuration to be used when creating
each actor with the help of <code>ray</code> library.
Can be left as None if additional configuration is not needed.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">env</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">network</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">env_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">network_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">observation_normalization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">decrease_rewards_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">alive_bonus_schedule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">action_noise_stdev</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">num_actors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;num_devices&quot;</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">num_gpus_per_actor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">num_subbatches</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">subbatch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">actor_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="sd">    Initialize the VecGymNE.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="sd">        env: Environment to be solved.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="sd">            If this is given as a string starting with &quot;gym::&quot; (e.g.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="sd">            &quot;gym::Humanoid-v4&quot;, etc.), then it is assumed that the target</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="sd">            environment is a classical gym environment.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="sd">            If this is given as a string starting with &quot;brax::&quot; (e.g.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="sd">            &quot;brax::humanoid&quot;, etc.), then it is assumed that the target</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="sd">            environment is a brax environment.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="sd">            If this is given as a string which does not contain &quot;::&quot; at</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="sd">            all (e.g. &quot;Humanoid-v4&quot;, etc.), then it is assumed that the</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="sd">            target environment is a classical gym environment. Therefore,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="sd">            &quot;gym::Humanoid-v4&quot; and &quot;Humanoid-v4&quot; are equivalent.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="sd">            If this argument is given as a Callable (maybe a function or a</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="sd">            class), then, with the assumption that this Callable expects</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="sd">            a keyword argument `num_envs: int`, this Callable is called</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="sd">            and its result (expected as a `gym.vector.VectorEnv` instance)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="sd">            is used as the environment.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="sd">        network: A network structure string, or a Callable (which can be</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="sd">            a class inheriting from `torch.nn.Module`, or a function</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="sd">            which returns a `torch.nn.Module` instance), or an instance</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="sd">            of `torch.nn.Module`.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="sd">            The object provided here determines the structure of the</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="sd">            neural network whose parameters will be evolved.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="sd">            A network structure string is a string which can be processed</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="sd">            by `evotorch.neuroevolution.net.str_to_net(...)`.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="sd">            Please see the documentation of the function</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="sd">            `evotorch.neuroevolution.net.str_to_net(...)` to see how such</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="sd">            a neural network structure string looks like.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="sd">            Note that this network can be a recurrent network.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="sd">            When the network&#39;s `forward(...)` method can optionally accept</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="sd">            an additional positional argument for the hidden state of the</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="sd">            network and returns an additional value for its next state,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="sd">            then the policy is treated as a recurrent one.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="sd">            When the network is given as a callable object (e.g.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="sd">            a subclass of `nn.Module` or a function) and this callable</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="sd">            object is decorated via `evotorch.decorators.pass_info`,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="sd">            the following keyword arguments will be passed:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="sd">            (i) `obs_length` (the length of the observation vector),</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="sd">            (ii) `act_length` (the length of the action vector),</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="sd">            (iii) `obs_shape` (the shape tuple of the observation space),</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="sd">            (iv) `act_shape` (the shape tuple of the action space),</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="sd">            (v) `obs_space` (the Box object specifying the observation</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="sd">            space, and</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="sd">            (vi) `act_space` (the Box object specifying the action</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="sd">            space). Note that `act_space` will always be given as a</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="sd">            `gym.spaces.Box` instance, even when the actual gym</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="sd">            environment has a discrete action space. This because</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="sd">            `VecGymNE` always expects the neural network to return</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="sd">            a tensor of floating-point numbers.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="sd">        env_config: Keyword arguments to pass to the environment while</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="sd">            it is being created.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="sd">        max_num_envs: Maximum number of environments to be instantiated.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="sd">            By default, this is None, which means that the number of</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="sd">            environments can go up to the population size (or up to the</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="sd">            number of solutions that a remote actor receives, if the</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="sd">            problem object is configured to have parallelization).</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="sd">            For situations where the current reinforcement learning task</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="sd">            requires large amount of resources (e.g. memory), allocating</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="sd">            environments as much as the number of solutions might not</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="sd">            be feasible. In such cases, one can set `max_num_envs` as an</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="sd">            integer to bring an upper bound (in total, across all the</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="sd">            remote actors, for when the problem is parallelized) to how</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="sd">            many environments can be allocated.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="sd">        network_args: Any additional keyword argument to be used when</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="sd">            instantiating the network can be specified via `network_args`</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="sd">            as a dictionary. If there are no such additional keyword</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="sd">            arguments, then `network_args` can be left as None.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="sd">            Note that the argument `network_args` is expected to be None</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="sd">            when the network is specified as a `torch.nn.Module` instance.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="sd">        observation_normalization: Whether or not online normalization</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="sd">            will be done on the encountered observations.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="sd">        decrease_rewards_by: If given as a float, each reward will be</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="sd">            decreased by this amount. For example, if the environment&#39;s</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="sd">            reward function has a constant &quot;alive bonus&quot; (i.e. a bonus</span>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="sd">            that is constantly added onto the reward as long as the</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="sd">            agent is alive), and if you wish to negate this bonus,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="sd">            you can set `decrease_rewards_by` to this bonus amount,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="sd">            and the bonus will be nullified.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="sd">            If you do not wish to affect the rewards in this manner,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="sd">            keep this as None.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="sd">        alive_bonus_schedule: Use this to add a customized amount of</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="sd">            alive bonus.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="sd">            If left as None (which is the default), additional alive</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="sd">            bonus will not be added.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="sd">            If given as a tuple `(t, b)`, an alive bonus `b` will be</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="sd">            added onto all the rewards beyond the timestep `t`.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="sd">            If given as a tuple `(t0, t1, b)`, a partial (linearly</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="sd">            increasing towards `b`) alive bonus will be added onto</span>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="sd">            all the rewards between the timesteps `t0` and `t1`,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="sd">            and a full alive bonus (which equals to `b`) will be added</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="sd">            onto all the rewards beyond the timestep `t1`.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="sd">        action_noise_stdev: If given as a real number `s`, then, for</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a><span class="sd">            each generated action, Gaussian noise with standard</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="sd">            deviation `s` will be sampled, and then this sampled noise</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="sd">            will be added onto the action.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a><span class="sd">            If action noise is not desired, then this argument can be</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="sd">            left as None.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="sd">            For sampling the noise, the global random number generator</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a><span class="sd">            of PyTorch on the simulator&#39;s device will be used.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="sd">        num_episodes: Number of episodes over which each policy will</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="sd">            be evaluated. The default is 1.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="sd">        device: The device in which the population will be kept.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a><span class="sd">            If you wish to do a single-GPU evolution, we recommend</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="sd">            to set this as &quot;cuda&quot; (or &quot;cuda:0&quot;, or &quot;cuda:1&quot;, etc.),</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="sd">            assuming that the simulator will also instantiate itself</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="sd">            on that same device.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a><span class="sd">            Alternatively, if you wish to do a multi-GPU evolution,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="sd">            we recommend to leave this as None or set this as &quot;cpu&quot;,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a><span class="sd">            so that the main population will be kept on the cpu</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a><span class="sd">            and the remote actors will perform their evaluations on</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a><span class="sd">            the GPUs that are assigned to them.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="sd">        num_actors: Number of actors.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="sd">            This is, by default, &quot;num_devices&quot; which creates multiple</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a><span class="sd">            actors in such a way that each actor will be assigned</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a><span class="sd">            an entire GPU.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="sd">            This default setting considers the multi-GPU scenario</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a><span class="sd">            (and requires multiple GPUs to work correctly).</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a><span class="sd">            If you wish to perform the entire evolution on a single</span>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="sd">            GPU, we recommend to set `num_actors` as 0 (so that there</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="sd">            will be no remote actors) and set `device` as &quot;cuda&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a><span class="sd">            (or &quot;cuda:0&quot;, or &quot;cuda:1&quot;, etc., the device in which the</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a><span class="sd">            simulator will be instantiated).</span>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a><span class="sd">            If you do not have any GPUs the special value &quot;num_devices&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="sd">            will allocate n actors, n being the number of CPUs.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a><span class="sd">            You can also set `num_actors` as an integer to determine</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="sd">            the exact number of subprocesses which will evaluate the</span>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a><span class="sd">            solutions in parallel. Note that, however, when you set</span>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="sd">            `num_actors` as an integer, you will also have to explicitly</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="sd">            specify the number of GPUs each actor will be assigned</span>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="sd">            via the argument `num_gpus_per_actor`.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="sd">        num_gpus_per_actor: Number of GPUs to be assigned to each</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a><span class="sd">            actor. This can be an integer or a float (for when you</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a><span class="sd">            wish to assign fractional amounts of GPUs to actors).</span>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a><span class="sd">            When `num_actors` has the special value &quot;num_devices&quot;,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="sd">            the argument `num_gpus_per_actor` is expected to be left as</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a><span class="sd">            None.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="sd">        num_subbatches: For when there are multiple actors, you can</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a><span class="sd">            set this to an integer n if you wish the population</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="sd">            to be divided exactly into n sub-batches. The actors, as they</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="sd">            finish their currently assigned sub-batch of solutions,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="sd">            will pick the next un-evaluated sub-batch.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="sd">            If you specify too large numbers for this argument, then</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="sd">            each sub-batch will be smaller.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="sd">            When working with vectorized simulators on GPU, having too</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a><span class="sd">            many and too small sub-batches can hurt the performance.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a><span class="sd">            This argument can be left as None, in which case, assuming</span>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a><span class="sd">            that `subbatch_size` is also None, the population will be</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a><span class="sd">            split to m sub-batches, m being the number of actors.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a><span class="sd">        subbatch_size: For when there are multiple actors, you can</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a><span class="sd">            set this to an integer n if you wish the population to be</span>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="sd">            divided into sub-batches in such a way that each sub-batch</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a><span class="sd">            will consist of exactly n solutions. The actors, as they</span>
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="sd">            finish their currently assigned sub-batch of solutions,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="sd">            will pick the next un-evaluated sub-batch.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a><span class="sd">            If you specify too small numbers for this argument, then</span>
<a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a><span class="sd">            there will be many sub-batches, each sub-batch having a</span>
<a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a><span class="sd">            small number of solutions.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="sd">            When working with vectorized simulators on GPU, having too</span>
<a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a><span class="sd">            many and too small sub-batches can hurt the performance.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a><span class="sd">            This argument can be left as None, in which case, assuming</span>
<a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a><span class="sd">            that `num_subbatches` is also None, the population will be</span>
<a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a><span class="sd">            split to m sub-batches, m being the number of actors.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="sd">        actor_config: Additional configuration to be used when creating</span>
<a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="sd">            each actor with the help of `ray` library.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a><span class="sd">            Can be left as None if additional configuration is not needed.</span>
<a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a>    <span class="c1"># Store the string or the Callable that will be used to generate the reinforcement learning environment.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span> <span class="o">=</span> <span class="n">env</span>
<a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a>    <span class="c1"># Declare the variable which will store the environment.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TorchWrapper</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a>    <span class="c1"># Declare the variable which will store the batch size of the vectorized environment.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a>    <span class="c1"># Store the upper bound (if any) regarding how many environments can exist at the same time.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">max_num_envs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_num_envs</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a>    <span class="c1"># Actor-specific upper bound regarding how many environments can exist at the same time.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a>    <span class="c1"># This variable will be filled by the `_parallelize(...)` method.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a>    <span class="c1"># Declare the variable which stores whether or not we properly initialized the `_actor_max_num_envs` variable.</span>
<a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_actor_max_num_envs_ready</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a>    <span class="c1"># Store the additional configurations to be used as keyword arguments while instantiating the environment.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">env_config</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">env_config</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a>    <span class="c1"># Declare the variable that will store the device of the simulator.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a>    <span class="c1"># This variable will be filled when the first observation is received from the environment.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a>    <span class="c1"># The device of the observation array received from the environment will determine the value of this variable.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_simulator_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a>    <span class="c1"># Store the neural network architecture (that might be a string or an `nn.Module` instance).</span>
<a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_architecture</span> <span class="o">=</span> <span class="n">network</span>
<a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a>    <span class="k">if</span> <span class="n">network_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a>        <span class="c1"># If `network_args` is given as None, change it to an empty dictionary</span>
<a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a>        <span class="n">network_args</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a>        <span class="c1"># If the network is given as a string, then we will need the values for the constants `obs_length`,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a>        <span class="c1"># `act_length`, and `obs_space`. To obtain those values, we use our helper function</span>
<a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a>        <span class="c1"># `_env_constants_for_str_net(...)` which temporarily instantiates the specified environment and returns</span>
<a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a>        <span class="c1"># its needed constants.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>        <span class="n">env_constants</span> <span class="o">=</span> <span class="n">_env_constants_for_str_net</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">))</span>
<a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a>        <span class="c1"># If the network is an already instantiated nn.Module, then we do not prepare any pre-defined constants.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a>        <span class="n">env_constants</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a>        <span class="c1"># If the network is given as a Callable, then we will need the values for the constants `obs_length`,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a>        <span class="c1"># `act_length`, and `obs_space`. To obtain those values, we use our helper function</span>
<a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>        <span class="c1"># `_env_constants_for_callable_net(...)` which temporarily instantiates the specified environment and</span>
<a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a>        <span class="c1"># returns its needed constants.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a>        <span class="n">env_constants</span> <span class="o">=</span> <span class="n">_env_constants_for_callable_net</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_config</span><span class="p">))</span>
<a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a>    <span class="c1"># Build a `Policy` instance according to the given architecture, and store it.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>        <span class="n">instantiated_net</span> <span class="o">=</span> <span class="n">str_to_net</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">env_constants</span><span class="p">,</span> <span class="o">**</span><span class="n">network_args</span><span class="p">})</span>
<a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a>        <span class="n">instantiated_net</span> <span class="o">=</span> <span class="n">network</span>
<a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a>        <span class="n">instantiated_net</span> <span class="o">=</span> <span class="n">pass_info_if_needed</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">env_constants</span><span class="p">)(</span><span class="o">**</span><span class="n">network_args</span><span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span> <span class="o">=</span> <span class="n">Policy</span><span class="p">(</span><span class="n">instantiated_net</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a>    <span class="c1"># Store the boolean which indicates whether or not there will be observation normalization.</span>
<a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_observation_normalization</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">observation_normalization</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a>    <span class="c1"># Declare the variables that will store the observation-related stats if observation normalization is enabled.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RunningNorm</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RunningNorm</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a>    <span class="c1"># Store the number of episodes configuration given by the user.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_num_episodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_episodes</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a>    <span class="c1"># Store the `decrease_rewards_by` configuration given by the user.</span>
<a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_decrease_rewards_by</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">decrease_rewards_by</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">decrease_rewards_by</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a>    <span class="k">if</span> <span class="n">alive_bonus_schedule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a>        <span class="c1"># If `alive_bonus_schedule` argument is None, then we store it as None as well.</span>
<a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a>        <span class="c1"># This is the case where the user has specified an `alive_bonus_schedule`.</span>
<a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a>        <span class="n">alive_bonus_schedule</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a>        <span class="n">alive_bonus_schedule_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a>        <span class="k">if</span> <span class="n">alive_bonus_schedule_length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a>            <span class="c1"># If `alive_bonus_schedule` was given as a 2-element sequence (t, b), then store it as (t, t, b).</span>
<a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>            <span class="c1"># This means that the partial alive bonus time window starts and ends at t, therefore, there will</span>
<a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a>            <span class="c1"># be no alive bonus until t, and beginning with t, there will be full alive bonus.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a>                <span class="nb">float</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>            <span class="p">]</span>
<a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a>        <span class="k">elif</span> <span class="n">alive_bonus_schedule_length</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a>            <span class="c1"># If `alive_bonus_schedule` was given as a 3-element sequence (t0, t1, b), then store those 3</span>
<a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a>            <span class="c1"># elements.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a>                <span class="nb">float</span><span class="p">(</span><span class="n">alive_bonus_schedule</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
<a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a>            <span class="p">]</span>
<a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a>            <span class="c1"># `alive_bonus_schedule` sequences with unrecognized lengths trigger an error.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a>                <span class="sa">f</span><span class="s2">&quot;Received invalid number elements as the alive bonus schedule.&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a>                <span class="sa">f</span><span class="s2">&quot; Expected 2 or 3 items, but got these: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a>                <span class="sa">f</span><span class="s2">&quot; (having a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alive_bonus_schedule</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a>            <span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a>    <span class="c1"># If `action_noise_stdev` is specified, store it.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_action_noise_stdev</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">action_noise_stdev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">action_noise_stdev</span><span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a>    <span class="c1"># Initialize the counters for the number of simulator interactions and the number of episodes.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a>    <span class="c1"># Call the superclass</span>
<a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a>        <span class="n">objective_sense</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a>        <span class="n">initial_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">),</span>
<a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a>        <span class="n">solution_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">parameter_length</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a>        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a>        <span class="n">num_actors</span><span class="o">=</span><span class="n">num_actors</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a>        <span class="n">num_gpus_per_actor</span><span class="o">=</span><span class="n">num_gpus_per_actor</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a>        <span class="n">actor_config</span><span class="o">=</span><span class="n">actor_config</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a>        <span class="n">num_subbatches</span><span class="o">=</span><span class="n">num_subbatches</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a>        <span class="n">subbatch_size</span><span class="o">=</span><span class="n">subbatch_size</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a>    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.get_env" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.get_env" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the gym environment.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[gym.core.Env]</code></td>
      <td><p>The gym environment if it is built. If not built yet, None.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">get_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">]:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Get the gym environment.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="sd">        The gym environment if it is built. If not built yet, None.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.get_observation_stats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.get_observation_stats" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get the observation stats</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">get_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunningNorm</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;Get the observation stats&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.make_net" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.make_net" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Make a new policy network parameterized by the given solution.
Note that this parameterized network assumes that the observation
is already normalized, and it does not do action clipping to ensure
that the generated actions are within valid bounds.</p>
<p>To have a policy network which has its own observation normalization
and action clipping layers, please see the method <code>to_policy(...)</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>solution</code></td>
        <td><code>Iterable</code></td>
        <td><p>The solution which stores the parameters.
This can be a Solution instance, or a 1-dimensional tensor,
or any Iterable of real numbers.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Module</code></td>
      <td><p>The policy network, as a PyTorch module.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">make_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Make a new policy network parameterized by the given solution.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">    Note that this parameterized network assumes that the observation</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="sd">    is already normalized, and it does not do action clipping to ensure</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="sd">    that the generated actions are within valid bounds.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="sd">    To have a policy network which has its own observation normalization</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">    and action clipping layers, please see the method `to_policy(...)`.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="sd">        solution: The solution which stores the parameters.</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="sd">            This can be a Solution instance, or a 1-dimensional tensor,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="sd">            or any Iterable of real numbers.</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="sd">        The policy network, as a PyTorch module.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_policy</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">with_wrapper_modules</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.pop_observation_stats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pop_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.pop_observation_stats" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Get and clear the collected observation stats</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">pop_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunningNorm</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;Get and clear the collected observation stats&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_collected_stats</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.save_solution" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.save_solution" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Save the solution into a pickle file.
Among the saved data within the pickle file are the solution
(as a PyTorch tensor), the policy (as a <code>torch.nn.Module</code> instance),
and observation stats (if any).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>solution</code></td>
        <td><code>Iterable</code></td>
        <td><p>The solution to be saved. This can be a PyTorch tensor,
a <code>Solution</code> instance, or any <code>Iterable</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>fname</code></td>
        <td><code>Union[str, pathlib.Path]</code></td>
        <td><p>The file name of the pickle file to be created.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">save_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Save the solution into a pickle file.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">    Among the saved data within the pickle file are the solution</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="sd">    (as a PyTorch tensor), the policy (as a `torch.nn.Module` instance),</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="sd">    and observation stats (if any).</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">        solution: The solution to be saved. This can be a PyTorch tensor,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="sd">            a `Solution` instance, or any `Iterable`.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="sd">        fname: The file name of the pickle file to be created.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="c1"># Convert the solution to a PyTorch tensor on the cpu.</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">Solution</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">ReadOnlyTensor</span><span class="p">):</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">as_subclass</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="c1"># Store the solution and the policy.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span class="s2">&quot;solution&quot;</span><span class="p">:</span> <span class="n">solution</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>        <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_policy</span><span class="p">(</span><span class="n">solution</span><span class="p">),</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="p">}</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="c1"># If available, store the observation stats.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_stdev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">stdev</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;obs_sum_of_squares&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">sum_of_squares</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="c1"># Some additional data.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;interaction_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;episode_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>        <span class="c1"># If the environment was specified via a string, store the string.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_maker</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    <span class="c1"># Store the network architecture.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;architecture&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_architecture</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    <span class="c1"># Save the dictionary which stores the data.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.set_episode_count" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_episode_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_episode_count" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the episode count manually.</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">set_episode_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Set the episode count manually.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.set_interaction_count" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_interaction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_interaction_count" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the interaction count manually.</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">set_interaction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Set the interaction count manually.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.set_observation_stats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.set_observation_stats" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Set the observation stats</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">set_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">:</span> <span class="n">RunningNorm</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;Set the observation stats&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="o">=</span> <span class="n">rn</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.to_policy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_wrapper_modules</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.to_policy" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Convert the given solution to a policy.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>solution</code></td>
        <td><code>Iterable</code></td>
        <td><p>A solution which can be given as a <code>torch.Tensor</code>, as a
<code>Solution</code>, or as any <code>Iterable</code>.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>with_wrapper_modules</code></td>
        <td><code>bool</code></td>
        <td><p>Whether or not to wrap the policy module
with helper modules so that observations are normalized
and actions are clipped to be within the correct boundaries.
The default and the recommended value is True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Module</code></td>
      <td><p>The policy, as a <code>torch.nn.Module</code> instance.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">to_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_wrapper_modules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Convert the given solution to a policy.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="sd">        solution: A solution which can be given as a `torch.Tensor`, as a</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="sd">            `Solution`, or as any `Iterable`.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="sd">        with_wrapper_modules: Whether or not to wrap the policy module</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">            with helper modules so that observations are normalized</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="sd">            and actions are clipped to be within the correct boundaries.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="sd">            The default and the recommended value is True.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="sd">        The policy, as a `torch.nn.Module` instance.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="c1"># Get the gym environment</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_env</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="c1"># Get the observation space, its lower and higher bounds.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">obs_space</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">single_action_space</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">obs_space</span><span class="o">.</span><span class="n">low</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">obs_space</span><span class="o">.</span><span class="n">high</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="c1"># If the lower and higher bounds are not -inf and +inf respectively, then this environment needs clipping.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="n">needs_clipping</span> <span class="o">=</span> <span class="n">_numpy_arrays_specify_bounds</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="c1"># Convert the solution to a PyTorch tensor on cpu.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">Solution</span><span class="p">):</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="n">solution</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>    <span class="c1"># Convert the internally stored policy to a PyTorch module.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">to_torch_module</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="k">if</span> <span class="n">with_wrapper_modules</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_normalization</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>            <span class="c1"># If observation normalization is needed and there are collected observation stats, then we wrap the</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>            <span class="c1"># policy with an ObsNormWrapperModule.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">ObsNormWrapperModule</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>        <span class="k">if</span> <span class="n">needs_clipping</span><span class="p">:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>            <span class="c1"># If clipping is needed, then we wrap the policy with an ActClipWrapperModule</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">ActClipWrapperModule</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">obs_space</span><span class="p">)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="evotorch.neuroevolution.vecgymne.VecGymNE.update_observation_stats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">)</span></code>


<a href="#evotorch.neuroevolution.vecgymne.VecGymNE.update_observation_stats" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Update the observation stats via another RunningNorm instance</p>

        <details class="quote">
          <summary>Source code in <code>evotorch/neuroevolution/vecgymne.py</code></summary>
          <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">update_observation_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rn</span><span class="p">:</span> <span class="n">RunningNorm</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="sd">&quot;&quot;&quot;Update the observation stats via another RunningNorm instance&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_obsnorm</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span> <span class="o">=</span> <span class="n">rn</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rn</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../supervisedne/" class="md-footer__link md-footer__link--prev" aria-label="Previous: supervisedne" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              supervisedne
            </div>
          </div>
        </a>
      
      
        
        <a href="../../operators/" class="md-footer__link md-footer__link--next" aria-label="Next: Index" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Index
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 NNAISENSE SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>