
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="EvoTorch is an open source evolutionary computation library developed at NNAISENSE, built on top of PyTorch.">
      
      
      
      
        <link rel="prev" href="../core/">
      
      
        <link rel="next" href="../distributions/">
      
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Decorators - EvoTorch</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#evotorch.decorators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://evotorch.ai" title="EvoTorch" class="md-header__button md-logo" aria-label="EvoTorch" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EvoTorch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Decorators
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/nnaisense/evotorch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    evotorch
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../quickstart/" class="md-tabs__link">
        
  
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../user_guide/general_usage/" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../advanced_usage/solution_batch/" class="md-tabs__link">
          
  
  
    
  
  Advanced Usage

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://evotorch.ai" title="EvoTorch" class="md-nav__button md-logo" aria-label="EvoTorch" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    EvoTorch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nnaisense/evotorch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    evotorch
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/general_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    General Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/algorithm_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/algorithms_tour/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms Tour
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/problems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Defining Problems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/problem_parallelization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Problem Parallelization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/neuroevolution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Neuroevolution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/gym/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Neuroevolution for Gym
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guide/supervised_ne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supervised Neuroevolution
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/solution_batch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manipulating Solutions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/dist_based/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Evolution Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/custom_ea/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Searchers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/custom_logger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Loggers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced_usage/ray_cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Ray Clusters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../examples/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Brax_Experiments_Visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization of the brax Experiment Results
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Brax_Experiments_with_PGPE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solving a Brax environment using EvoTorch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Evolving_Objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evolving Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Feature_Space_Illumination_with_MAPElites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Space Illumination with MAPElites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Genetic_Programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Genetic Programming using EvoTorch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Gym_Experiments_with_PGPE_and_CoSyNE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gym Experiments with PGPE and CoSyNE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Minimizing_Lennard-Jones_Atom_Cluster_Potentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Minimising Lennard-Jones Atom Cluster Potentials with Evolution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Training_MNIST30K/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training MNIST30K
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/Variational_Quantum_Eigensolvers_with_SNES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Variational Quantum Eigensolvers with SNES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/batched_searches/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maintaining a batch of populations using the functional EvoTorch API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/constrained/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solving constrained optimization problems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/func_rl_ga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evolving objects using the functional operators API of EvoTorch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/functional_ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Genetic algorithm with the help of functional operators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/multiobj_batched_ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multiobjective optimization via functional operators API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/problem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solving reinforcement learning tasks using functional evolutionary algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/notebooks/reacher_mpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Predictive Control (MPC) with EvoTorch
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Evotorch
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1" id="__nav_6_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Evotorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Decorators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Decorators
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators" class="md-nav__link">
    <span class="md-ellipsis">
      decorators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.expects_ndim" class="md-nav__link">
    <span class="md-ellipsis">
      expects_ndim
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.on_aux_device" class="md-nav__link">
    <span class="md-ellipsis">
      on_aux_device
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.on_cuda" class="md-nav__link">
    <span class="md-ellipsis">
      on_cuda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.on_device" class="md-nav__link">
    <span class="md-ellipsis">
      on_device
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.pass_info" class="md-nav__link">
    <span class="md-ellipsis">
      pass_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.rowwise" class="md-nav__link">
    <span class="md-ellipsis">
      rowwise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.vectorized" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../distributions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimizers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimizers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../algorithms/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_8" id="__nav_6_1_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_8">
            <span class="md-nav__icon md-icon"></span>
            Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/cmaes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cmaes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/ga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ga
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/mapelites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mapelites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/pycmaes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pycmaes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/searchalgorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Searchalgorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_8_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../algorithms/distributed/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Distributed
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_8_7" id="__nav_6_1_8_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_8_7">
            <span class="md-nav__icon md-icon"></span>
            Distributed
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/distributed/gaussian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gaussian
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_8_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../algorithms/functional/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Functional
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_8_8" id="__nav_6_1_8_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_8_8">
            <span class="md-nav__icon md-icon"></span>
            Functional
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/functional/funcadam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funcadam
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/functional/funccem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funccem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/functional/funcclipup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funcclipup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/functional/funcpgpe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funcpgpe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/functional/funcsgd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funcsgd
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/functional/misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_8_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../algorithms/restarter/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Restarter
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_8_9" id="__nav_6_1_8_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_8_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_8_9">
            <span class="md-nav__icon md-icon"></span>
            Restarter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/restarter/modify_restart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modify restart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/restarter/restart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../neuroevolution/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Neuroevolution
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_9" id="__nav_6_1_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_9">
            <span class="md-nav__icon md-icon"></span>
            Neuroevolution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/baseneproblem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Baseneproblem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/gymne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gymne
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/neproblem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Neproblem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/supervisedne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supervisedne
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/vecgymne/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vecgymne
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_9_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../neuroevolution/net/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Net
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_9_7" id="__nav_6_1_9_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_9_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_9_7">
            <span class="md-nav__icon md-icon"></span>
            Net
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/functional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/layers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Layers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/multilayered/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multilayered
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/rl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/runningnorm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runningnorm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/runningstat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runningstat
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/statefulmodule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Statefulmodule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neuroevolution/net/vecrl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vecrl
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../operators/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Operators
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_10" id="__nav_6_1_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_10">
            <span class="md-nav__icon md-icon"></span>
            Operators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operators/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operators/functional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operators/real/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operators/sequence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sequence
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../tools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_11" id="__nav_6_1_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_11">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/cloning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/constraints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constraints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/hook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/immutable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Immutable
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/objectarray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Objectarray
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/ranking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ranking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/readonlytensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Readonlytensor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/recursiveprintable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recursiveprintable
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Structures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/tensorframe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tensorframe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/tensormaker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tensormaker
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators" class="md-nav__link">
    <span class="md-ellipsis">
      decorators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.expects_ndim" class="md-nav__link">
    <span class="md-ellipsis">
      expects_ndim
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.on_aux_device" class="md-nav__link">
    <span class="md-ellipsis">
      on_aux_device
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.on_cuda" class="md-nav__link">
    <span class="md-ellipsis">
      on_cuda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.on_device" class="md-nav__link">
    <span class="md-ellipsis">
      on_device
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.pass_info" class="md-nav__link">
    <span class="md-ellipsis">
      pass_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.rowwise" class="md-nav__link">
    <span class="md-ellipsis">
      rowwise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evotorch.decorators.vectorized" class="md-nav__link">
    <span class="md-ellipsis">
      vectorized
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Decorators</h1>

<div class="doc doc-object doc-module">



<a id="evotorch.decorators"></a>
    <div class="doc doc-contents first">

        <p>Module defining decorators for evotorch.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.expects_ndim" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expects_ndim</span><span class="p">(</span><span class="o">*</span><span class="n">expected_ndims</span><span class="p">,</span> <span class="n">allow_smaller_ndim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">randomness</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span></code>

<a href="#evotorch.decorators.expects_ndim" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorator to declare the number of dimensions for each positional argument.</p>
<p>Let us imagine that we have a function <code>f(a, b)</code>, where <code>a</code> and <code>b</code> are
PyTorch tensors. Let us also imagine that the function <code>f</code> is implemented
in such a way that <code>a</code> is assumed to be a 2-dimensional tensor, and <code>b</code>
is assumed to be a 1-dimensional tensor. In this case, the function <code>f</code>
can be decorated as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">expects_ndim</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nd">@expects_ndim</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div>
<p>Once decorated like this, the function <code>f</code> will gain the following
additional behaviors:</p>
<ul>
<li>If less-than-expected number of dimensions are provided either for
  <code>a</code> or for <code>b</code>, an error will be raised (unless the decorator
  is provided with the keyword argument <code>allow_smaller_ndim=True</code>)</li>
<li>If either <code>a</code> or <code>b</code> are given as tensors that have extra leftmost
  dimensions, those dimensions will be assumed as batch dimensions,
  and therefore, the function <code>f</code> will run in a vectorized manner
  (with the help of <code>vmap</code> behind the scene), and the result will be
  a tensor with extra leftmost dimension(s), representing a batch
  of resulting tensors.</li>
<li>For convenience, numpy arrays and scalar data that are subclasses
  of <code>numbers.Number</code> will be converted to PyTorch tensors first, and
  then will be processed.</li>
</ul>
<p>To be able to take advantage of this decorator, please ensure that the
decorated function is a <code>vmap</code>-friendly function. Please also ensure
that the decorated function expects positional arguments only.</p>
<p><strong>Randomness.</strong>
Like in <code>torch.func.vmap</code>, the behavior of the decorated function in
terms of randomness can be configured via a keyword argument named
<code>randomness</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nd">@expects_ndim</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">randomness</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div>
<p>If <code>randomness</code> is set as "error", then, when there is batching, any
attempt to generate random data using PyTorch will raise an error.
If <code>randomness</code> is set as "different", then, a random generation
operation such as <code>torch.randn(...)</code> will produce a <code>BatchedTensor</code>,
where each batch item has its own re-sampled data.
If <code>randomness</code> is set as "same", then, a random generation operation
such as <code>torch.randn(...)</code> will produce a non-batched tensor containing
random data that is sampled only once.</p>
<p><strong>Alternative usage.</strong>
<code>expects_ndim</code> has an alternative interface that allows one to use it
as a tool for temporarily wrapping/transforming other functions. Let us
consider again our example function <code>f</code>. Instead of using the decorator
syntax, one can do:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">result</span> <span class="o">=</span> <span class="n">expects_ndim</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div>
<p>which will temporarily wrap the function <code>f</code> with the additional behaviors
mentioned above, and immediately call it with the arguments <code>a</code> and <code>b</code>.</p>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="k">def</span><span class="w"> </span><span class="nf">expects_ndim</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="o">*</span><span class="n">expected_ndims</span><span class="p">,</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">allow_smaller_ndim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">randomness</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">    Decorator to declare the number of dimensions for each positional argument.</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">    Let us imagine that we have a function `f(a, b)`, where `a` and `b` are</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    PyTorch tensors. Let us also imagine that the function `f` is implemented</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">    in such a way that `a` is assumed to be a 2-dimensional tensor, and `b`</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">    is assumed to be a 1-dimensional tensor. In this case, the function `f`</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">    can be decorated as follows:</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    from evotorch.decorators import expects_ndim</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">    @expects_ndim(2, 1)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    def f(a: torch.Tensor, b: torch.Tensor) -&gt; torch.Tensor: ...</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">    ```</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="sd">    Once decorated like this, the function `f` will gain the following</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    additional behaviors:</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    - If less-than-expected number of dimensions are provided either for</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">      `a` or for `b`, an error will be raised (unless the decorator</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">      is provided with the keyword argument `allow_smaller_ndim=True`)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    - If either `a` or `b` are given as tensors that have extra leftmost</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">      dimensions, those dimensions will be assumed as batch dimensions,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">      and therefore, the function `f` will run in a vectorized manner</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">      (with the help of `vmap` behind the scene), and the result will be</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">      a tensor with extra leftmost dimension(s), representing a batch</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">      of resulting tensors.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">    - For convenience, numpy arrays and scalar data that are subclasses</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">      of `numbers.Number` will be converted to PyTorch tensors first, and</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">      then will be processed.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    To be able to take advantage of this decorator, please ensure that the</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    decorated function is a `vmap`-friendly function. Please also ensure</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">    that the decorated function expects positional arguments only.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">    **Randomness.**</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">    Like in `torch.func.vmap`, the behavior of the decorated function in</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">    terms of randomness can be configured via a keyword argument named</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">    `randomness`:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">    @expects_ndim(2, 1, randomness=&quot;error&quot;)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">    def f(a: torch.Tensor, b: torch.Tensor) -&gt; torch.Tensor: ...</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">    ```</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    If `randomness` is set as &quot;error&quot;, then, when there is batching, any</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">    attempt to generate random data using PyTorch will raise an error.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">    If `randomness` is set as &quot;different&quot;, then, a random generation</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    operation such as `torch.randn(...)` will produce a `BatchedTensor`,</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    where each batch item has its own re-sampled data.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    If `randomness` is set as &quot;same&quot;, then, a random generation operation</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    such as `torch.randn(...)` will produce a non-batched tensor containing</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">    random data that is sampled only once.</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    **Alternative usage.**</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    `expects_ndim` has an alternative interface that allows one to use it</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">    as a tool for temporarily wrapping/transforming other functions. Let us</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    consider again our example function `f`. Instead of using the decorator</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">    syntax, one can do:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    result = expects_ndim(f, (2, 1))(a, b)</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">    ```</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    which will temporarily wrap the function `f` with the additional behaviors</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    mentioned above, and immediately call it with the arguments `a` and `b`.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expected_ndims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_ndims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Callable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expected_ndims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="n">func_to_wrap</span><span class="p">,</span> <span class="n">expected_ndims</span> <span class="o">=</span> <span class="n">expected_ndims</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>        <span class="k">return</span> <span class="n">expects_ndim</span><span class="p">(</span><span class="o">*</span><span class="n">expected_ndims</span><span class="p">,</span> <span class="n">allow_smaller_ndim</span><span class="o">=</span><span class="n">allow_smaller_ndim</span><span class="p">,</span> <span class="n">randomness</span><span class="o">=</span><span class="n">randomness</span><span class="p">)(</span><span class="n">func_to_wrap</span><span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>    <span class="n">expected_ndims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">expected_arg_ndim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">expected_arg_ndim</span><span class="p">))</span> <span class="k">for</span> <span class="n">expected_arg_ndim</span> <span class="ow">in</span> <span class="n">expected_ndims</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="p">)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">expects_ndim_decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">expects_ndim_decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="c1"># The inner class below is responsible for accumulating the dtype and device info of the tensors</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="c1"># encountered across the arguments received by the decorated function.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>            <span class="c1"># Such dtype and device information will be used if one of the considered arguments is given as a native</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="c1"># scalar object (i.e. float), when converting that native scalar object to a PyTorch tensor.</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="k">class</span><span class="w"> </span><span class="nc">tensor_info</span><span class="p">:</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>                <span class="c1"># At first, we initialize the set of encountered dtype and device info as None.</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="c1"># They will be lazily filled if we ever need such information.</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>                <span class="n">encountered_dtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>                <span class="n">encountered_devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                <span class="nd">@classmethod</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>                <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                    <span class="c1"># Collect and fill the dtype and device information if it is not filled yet.</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                    <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">encountered_dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">encountered_devices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">encountered_dtypes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">encountered_devices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                        <span class="k">for</span> <span class="n">expected_arg_ndim</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_ndims</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">expected_arg_ndims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                                <span class="c1"># If the argument has a declared expected ndim, and also if it is a PyTorch tensor,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                                <span class="c1"># then we add its dtype and device information to the sets `encountered_dtypes` and</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                                <span class="c1"># `encountered_devices`.</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                                <span class="bp">cls</span><span class="o">.</span><span class="n">encountered_dtypes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                                <span class="bp">cls</span><span class="o">.</span><span class="n">encountered_devices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                <span class="nd">@classmethod</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_get_unique_dtype</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                    <span class="c1"># Ensure that there is only one `dtype` and return it.</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                    <span class="c1"># If there is not exactly one dtype, then raise an error.</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">encountered_dtypes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                        <span class="p">[</span><span class="n">dtype</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">encountered_dtypes</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                        <span class="k">return</span> <span class="n">dtype</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                <span class="nd">@classmethod</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_get_unique_device</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                    <span class="c1"># Ensure that there is only one `device` and return it.</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                    <span class="c1"># If there is not exactly one device, then raise an error.</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">encountered_devices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                        <span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">encountered_devices</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                        <span class="k">return</span> <span class="n">device</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                <span class="nd">@classmethod</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                <span class="k">def</span><span class="w"> </span><span class="nf">convert_scalar_to_tensor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">scalar</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                    <span class="c1"># This class method aims to convert a scalar to a PyTorch tensor.</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                    <span class="c1"># The dtype and device of the tensor counterpart of the scalar will be taken from the dtype and</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                    <span class="c1"># device information of the other tensors encountered so far.</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                    <span class="c1"># First, we update the dtype and device information that can be collected from the arguments.</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                    <span class="c1"># Get the device used by the tensor arguments.</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                    <span class="n">device</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_unique_device</span><span class="p">(</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                        <span class="sa">f</span><span class="s2">&quot;The function decorated with `expects_ndim` received the scalar argument </span><span class="si">{</span><span class="n">scalar</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                        <span class="sa">f</span><span class="s2">&quot; However, this scalar argument cannot be converted to a PyTorch tensor, because it is not&quot;</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                        <span class="s2">&quot; clear to which device should this scalar be moved.&quot;</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                        <span class="s2">&quot; This might happen when none of the other considered arguments is a tensor,&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                        <span class="s2">&quot; or when there are multiple tensor arguments with conflicting devices.&quot;</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                        <span class="sa">f</span><span class="s2">&quot; Devices encountered across all the considered arguments are: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">encountered_devices</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                        <span class="s2">&quot; To make this error go away, please consider making sure that other tensor arguments have a&quot;</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                        <span class="s2">&quot; consistent device, or passing this scalar as a PyTorch tensor so that no conversion is&quot;</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>                        <span class="s2">&quot; needed.&quot;</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                    <span class="p">)</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)):</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                        <span class="c1"># If the given scalar argument is a boolean, we declare the dtype of its tensor counterpart as</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>                        <span class="c1"># torch.bool.</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>                        <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                        <span class="c1"># If the given scalar argument is not a boolean, we declare the dtype of its tensor counterpart</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                        <span class="c1"># as the dtype that is observed across the other arguments.</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_unique_dtype</span><span class="p">(</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                            <span class="sa">f</span><span class="s2">&quot; The function decorated with `expects_ndim` received the scalar argument </span><span class="si">{</span><span class="n">scalar</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                            <span class="s2">&quot; However, this scalar argument cannot be converted to a PyTorch tensor, because it is not&quot;</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                            <span class="s2">&quot; clear by which dtype should this scalar be represented in its tensor form.&quot;</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                            <span class="s2">&quot; This might happen when none of the other considered arguments is a tensor,&quot;</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                            <span class="s2">&quot; or when there are multiple tensor arguments with different dtypes.&quot;</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                            <span class="sa">f</span><span class="s2">&quot; dtypes encountered across all the considered arguments are </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">encountered_dtypes</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                            <span class="s2">&quot; To make this error go away, please consider making sure that other tensor arguments have&quot;</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                            <span class="s2">&quot; a consistent dtype, or passing this scalar as a PyTorch tensor so that no conversion is&quot;</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>                            <span class="s2">&quot; needed.&quot;</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                        <span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                    <span class="c1"># Finally, using our new dtype and new device, we convert the scalar to a tensor.</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="c1"># First, we want to make sure that each positional argument is a PyTorch tensor.</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>            <span class="c1"># So, we initialize `new_args` as an empty list, which will be filled with the tensor counterparts</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="c1"># of the original positional arguments.</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="n">new_args</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="k">for</span> <span class="n">i_arg</span><span class="p">,</span> <span class="p">(</span><span class="n">expected_arg_ndims</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">expected_ndims</span><span class="p">,</span> <span class="n">args</span><span class="p">)):</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">expected_arg_ndims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                    <span class="c1"># In this case, either the expected number of dimensions is given as None (indicating that the user</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                    <span class="c1"># does not wish any batching nor any conversion for this argument), or the argument is already</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                    <span class="c1"># a PyTorch tensor (so, no conversion to tensor needs to be done).</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                    <span class="c1"># We do not have to do anything in this case.</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                    <span class="k">pass</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)):</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                    <span class="c1"># If the argument is a scalar `Number`, we convert it to a PyTorch tensor, the dtype and the device</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                    <span class="c1"># of it being determined with the help of the inner class `tensor_info`.</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                    <span class="n">arg</span> <span class="o">=</span> <span class="n">tensor_info</span><span class="o">.</span><span class="n">convert_scalar_to_tensor</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                    <span class="c1"># If the argument is a numpy array, we convert it to a PyTorch tensor.</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                    <span class="n">arg</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                    <span class="c1"># This is the case where an object of an unrecognized type is received. We do not know how to</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                    <span class="c1"># process this argument, and, naively trying to convert it to a PyTorch tensor could fail, or</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                    <span class="c1"># could generate an unexpected result. So, we raise an error.</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received an argument of unexpected type: </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2"> (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">expected_arg_ndims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="n">expected_arg_ndims</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">allow_smaller_ndim</span><span class="p">):</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                    <span class="c1"># This is the case where the currently analyzed positional argument has less-than-expected number</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                    <span class="c1"># of dimensions, and we are not in the allow-smaller-ndim mode. So, we raise an error.</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                        <span class="sa">f</span><span class="s2">&quot;The argument with index </span><span class="si">{</span><span class="n">i_arg</span><span class="si">}</span><span class="s2"> has the shape </span><span class="si">{</span><span class="n">arg</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, having </span><span class="si">{</span><span class="n">arg</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dimensions.&quot;</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>                        <span class="sa">f</span><span class="s2">&quot; However, it was expected as a tensor with </span><span class="si">{</span><span class="n">expected_arg_ndims</span><span class="si">}</span><span class="s2"> dimensions.&quot;</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                    <span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                <span class="c1"># At this point, we know that `arg` is a proper PyTorch tensor. So, we add it into `new_args`.</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="n">wrapped_fn</span> <span class="o">=</span> <span class="n">fn</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="n">num_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_args</span><span class="p">)</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="n">wrapped_ndims</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                <span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="n">expected_arg_ndim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">arg</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                <span class="k">for</span> <span class="n">expected_arg_ndim</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_ndims</span><span class="p">,</span> <span class="n">new_args</span><span class="p">)</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="p">]</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="c1"># The following loop will run until we know that no `vmap` is necessary.</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                <span class="c1"># Within each iteration, at first, we assume that `vmap` is not necessary, and therefore, for each</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                <span class="c1"># positional argument, the batching dimension is `None` (which means no argument will be batched).</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                <span class="n">needs_vmap</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                <span class="n">in_dims</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">new_args</span><span class="p">]</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                <span class="k">for</span> <span class="n">i_arg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_args</span><span class="p">):</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                    <span class="c1"># For each positional argument with index `i_arg`, we check whether or not there are extra leftmost</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                    <span class="c1"># dimensions.</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">wrapped_ndims</span><span class="p">[</span><span class="n">i_arg</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wrapped_ndims</span><span class="p">[</span><span class="n">i_arg</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">expected_ndims</span><span class="p">[</span><span class="n">i_arg</span><span class="p">]):</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>                        <span class="c1"># This is the case where the number of dimensions associated with this positional argument is</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>                        <span class="c1"># greater than its expected number of dimensions.</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>                        <span class="c1"># We take note that there is at least one positional argument which requires `vmap`.</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>                        <span class="n">needs_vmap</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>                        <span class="c1"># We declare that this argument&#39;s batching dimension is 0 (i.e. its leftmost dimension).</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>                        <span class="n">in_dims</span><span class="p">[</span><span class="n">i_arg</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>                        <span class="c1"># Now that we marked the leftmost dimension of this argument as the batching dimension, we</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                        <span class="c1"># should not consider this dimension in the next iteration of this `while` loop. So, we</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                        <span class="c1"># decrease its number of not-yet-handled dimensions by 1.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                        <span class="n">wrapped_ndims</span><span class="p">[</span><span class="n">i_arg</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                <span class="k">if</span> <span class="n">needs_vmap</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>                    <span class="c1"># This is the case where there was at least one positional argument that needs `vmap`.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                    <span class="c1"># Therefore, we wrap the function via `vmap`.</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>                    <span class="c1"># Note that, after this `vmap` wrapping, if some of the positional arguments still have extra</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>                    <span class="c1"># leftmost dimensions, another level of `vmap`-wrapping will be done by the next iteration of this</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>                    <span class="c1"># `while` loop.</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>                    <span class="n">wrapped_fn</span> <span class="o">=</span> <span class="n">vmap</span><span class="p">(</span><span class="n">wrapped_fn</span><span class="p">,</span> <span class="n">in_dims</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">in_dims</span><span class="p">),</span> <span class="n">randomness</span><span class="o">=</span><span class="n">randomness</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                    <span class="c1"># This is the case where no positional argument with extra leftmost dimension was found.</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                    <span class="c1"># Either the positional arguments were non-batched to begin with, or the `vmap`-wrapping of the</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>                    <span class="c1"># previous iterations of this `while` loop were sufficient. Therefore, we are now ready to quit</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                    <span class="c1"># this loop.</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                    <span class="k">break</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="c1"># Run the `vmap`-wrapped counterpart of the function and return its result</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="k">return</span> <span class="n">wrapped_fn</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="k">return</span> <span class="n">expects_ndim_decorated</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>    <span class="k">return</span> <span class="n">expects_ndim_decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.on_aux_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_aux_device</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#evotorch.decorators.on_aux_device" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorator that informs a problem object that this function wants to
receive its solutions on the auxiliary device of the problem.</p>
<p>According to its default (non-overriden) implementation, a problem
object returns <code>torch.device("cuda")</code> as its auxiliary device if
PyTorch's cuda backend is available and if there is a visible cuda
device. Otherwise, the auxiliary device is returned as
<code>torch.device("cpu")</code>.
The auxiliary device is meant as a secondary device (in addition
to the main device reported by the problem object's <code>device</code>
attribute) used mainly for boosting the performance of fitness
evaluations.
This decorator, therefore, tells a problem object that the fitness
function requests to receive its solutions on this secondary device.</p>
<p>What this decorator does is that it injects a new attribute named
<code>__evotorch_on_aux_device__</code> onto the decorated callable object,
then sets that new attribute to <code>True</code>, and then return the decorated
callable object itself. Upon seeing this new attribute with the
value <code>True</code>, a <a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a> object will attempt
to move the solutions to its auxiliary device before calling the
decorated fitness function.</p>
<p>Let us imagine a fitness function <code>f</code> whose definition looks like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>In its not-yet-decorated form, the function <code>f</code> would be given <code>x</code> on the
main device of the associated problem object. However, if one decorates
<code>f</code> as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">on_aux_device</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nd">@on_aux_device</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>then the Problem object will first move <code>x</code> onto its auxiliary device,
then will call <code>f</code>.</p>
<p>This decorator is useful on multi-GPU settings. For details, please see
the following example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Problem</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">on_aux_device</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nd">@on_aux_device</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="s2">&quot;min&quot;</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">f</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">num_actors</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">num_gpus_per_actor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">)</span>
</code></pre></div>
<p>In the example code above, we assume that there are 4 GPUs available.
The main device of the problem is "cpu", which means the populations
will be generated on the cpu. When evaluating a population, the population
will be split into 4 subbatches (because we have 4 actors), and each
subbatch will be sent to an actor. Thanks to the decorator <code>@on_aux_device</code>,
the <a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a> instance on each actor will first move
its <a class="autorefs autorefs-internal" href="../core/#evotorch.core.SolutionBatch">SolutionBatch</a> to its auxiliary device
visible to the actor, and then the fitness function will perform its
fitness evaluations on that device. In summary, the actors will use their
associated auxiliary devices (most commonly "cuda") to evaluate the
fitnesses of the solutions in parallel.</p>
<p>This decorator can also be used to decorate the method <code>_evaluate</code> or
<code>_evaluate_batch</code> belonging to a custom subclass of
<a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a>. Please see the example below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Problem</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyCustomProblem</span><span class="p">(</span><span class="n">Problem</span><span class="p">):</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>            <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>  <span class="c1"># populations will be created on the cpu</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>            <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="nd">@on_aux_device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>  <span class="c1"># evaluations will be on the auxiliary device</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solutions</span><span class="p">:</span> <span class="n">SolutionBatch</span><span class="p">):</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        <span class="n">fitnesses</span> <span class="o">=</span> <span class="o">...</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        <span class="n">solutions</span><span class="o">.</span><span class="n">set_evals</span><span class="p">(</span><span class="n">fitnesses</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="k">def</span><span class="w"> </span><span class="nf">on_aux_device</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    Decorator that informs a problem object that this function wants to</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    receive its solutions on the auxiliary device of the problem.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    According to its default (non-overriden) implementation, a problem</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    object returns `torch.device(&quot;cuda&quot;)` as its auxiliary device if</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    PyTorch&#39;s cuda backend is available and if there is a visible cuda</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    device. Otherwise, the auxiliary device is returned as</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    `torch.device(&quot;cpu&quot;)`.</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    The auxiliary device is meant as a secondary device (in addition</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    to the main device reported by the problem object&#39;s `device`</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    attribute) used mainly for boosting the performance of fitness</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    evaluations.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    This decorator, therefore, tells a problem object that the fitness</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    function requests to receive its solutions on this secondary device.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    What this decorator does is that it injects a new attribute named</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">    `__evotorch_on_aux_device__` onto the decorated callable object,</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    then sets that new attribute to `True`, and then return the decorated</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    callable object itself. Upon seeing this new attribute with the</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    value `True`, a [Problem][evotorch.core.Problem] object will attempt</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    to move the solutions to its auxiliary device before calling the</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    decorated fitness function.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    Let us imagine a fitness function `f` whose definition looks like:</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        return torch.sum(x, dim=-1)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    ```</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    In its not-yet-decorated form, the function `f` would be given `x` on the</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    main device of the associated problem object. However, if one decorates</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    `f` as follows:</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    from evotorch.decorators import on_aux_device</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    @on_aux_device</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">        return torch.sum(x, dim=-1)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    ```</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    then the Problem object will first move `x` onto its auxiliary device,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">    then will call `f`.</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">    This decorator is useful on multi-GPU settings. For details, please see</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">    the following example:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    from evotorch import Problem</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    from evotorch.decorators import on_aux_device</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    @on_aux_device</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor: ...</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">    problem = Problem(</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">        &quot;min&quot;,</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        f,</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        num_actors=4,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        num_gpus_per_actor=1,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        device=&quot;cpu&quot;,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    )</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    ```</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    In the example code above, we assume that there are 4 GPUs available.</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    The main device of the problem is &quot;cpu&quot;, which means the populations</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    will be generated on the cpu. When evaluating a population, the population</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    will be split into 4 subbatches (because we have 4 actors), and each</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    subbatch will be sent to an actor. Thanks to the decorator `@on_aux_device`,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    the [Problem][evotorch.core.Problem] instance on each actor will first move</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    its [SolutionBatch][evotorch.core.SolutionBatch] to its auxiliary device</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    visible to the actor, and then the fitness function will perform its</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    fitness evaluations on that device. In summary, the actors will use their</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    associated auxiliary devices (most commonly &quot;cuda&quot;) to evaluate the</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    fitnesses of the solutions in parallel.</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">    This decorator can also be used to decorate the method `_evaluate` or</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    `_evaluate_batch` belonging to a custom subclass of</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    [Problem][evotorch.core.Problem]. Please see the example below:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    from evotorch import Problem</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    class MyCustomProblem(Problem):</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">        def __init__(self):</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">            super().__init__(</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">                ...,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">                device=&quot;cpu&quot;,  # populations will be created on the cpu</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">                ...,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">            )</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        @on_aux_device(&quot;cuda&quot;)  # evaluations will be on the auxiliary device</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">        def _evaluate_batch(self, solutions: SolutionBatch):</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">            fitnesses = ...</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">            solutions.set_evals(fitnesses)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    ```</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">return</span> <span class="n">_simple_decorator</span><span class="p">(</span><span class="s2">&quot;__evotorch_on_aux_device__&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">decorator_name</span><span class="o">=</span><span class="s2">&quot;on_aux_device&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.on_cuda" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_cuda</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#evotorch.decorators.on_cuda" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorator that informs a problem object that this function wants to
receive its solutions on a cuda device (optionally of the specified
cuda index).</p>
<p>Decorating a fitness function like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>@on_cuda
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>def f(...):
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    ...
</code></pre></div>
<p>is equivalent to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>@on_device(&quot;cuda&quot;)
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>def f(...):
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    ...
</code></pre></div>
<p>Decorating a fitness function like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>@on_cuda(0)
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>def f(...):
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    ...
</code></pre></div>
<p>is equivalent to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>@on_device(&quot;cuda:0&quot;)
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>def f(...):
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    ...
</code></pre></div>
<p>Please see the documentation of <a class="autorefs autorefs-internal" title="on_device(device)" href="#evotorch.decorators.on_device">on_device</a>
for further details.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional positional arguments using which one can specify
the index of the cuda device to use.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="k">def</span><span class="w"> </span><span class="nf">on_cuda</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    Decorator that informs a problem object that this function wants to</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    receive its solutions on a cuda device (optionally of the specified</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    cuda index).</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    Decorating a fitness function like this:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    ```</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    @on_cuda</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    def f(...):</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        ...</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    ```</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    is equivalent to:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    ```</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    @on_device(&quot;cuda&quot;)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    def f(...):</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        ...</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    ```</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    Decorating a fitness function like this:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    ```</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    @on_cuda(0)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    def f(...):</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        ...</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    ```</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    is equivalent to:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    ```</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    @on_device(&quot;cuda:0&quot;)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    def f(...):</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">        ...</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    ```</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    Please see the documentation of [on_device][evotorch.decorators.on_device]</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    for further details.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        args: An optional positional arguments using which one can specify</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            the index of the cuda device to use.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="c1"># Get the number of arguments</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="n">nargs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="c1"># If the number of arguments is 0, then we assume that we are in this situation:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="c1">#</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="c1">#     @on_cuda()</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="c1">#     def f(...):</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="c1">#         ...</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="c1">#</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="c1"># There is no specified index, and we are not yet given which object to decorate.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="c1"># Therefore, we set both of them as None.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">fn</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="c1"># The number of arguments is 1. We begin by storing that single argument using a variable named `arg`.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Callable</span><span class="p">):</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="c1"># If the argument is a callable object, we assume that we are in this situation:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="c1">#</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="c1">#     @on_cuda</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="c1">#     def f(...):</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="c1">#         ...</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="c1"># We are not given a cuda index</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="c1"># We are given our function to decorate. We store that function using a variable named `fn`.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">arg</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="c1"># If the argument is not a callable object, we assume that it is a cuda index, and that we are in the</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="c1"># following situation:</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="c1">#</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="c1">#     @on_cuda(index)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="c1">#     def f(...):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="c1">#         ...</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="c1"># We are given a cuda index. After making sure that it is an integer, we store it by a variable named</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="c1"># `index`.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="c1"># At this moment, we do not know the function that is being decorated. So, we set `fn` as None.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">fn</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="c1"># If the number of arguments is neither 0 nor 1, then this is an unexpected case.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="c1"># We raise an error to inform the user.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`on_cuda(...)` received invalid number of arguments&quot;</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="c1"># Prepare the device as &quot;cuda&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="n">device_str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="c1"># If a cuda index is given, then we add &quot;:N&quot; (where N is the index) to the end of `device_str`.</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">device_str</span> <span class="o">+=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="c1"># Prepare the decorator function which, upon being called with a function argument, wraps that function.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="n">decorator</span> <span class="o">=</span> <span class="n">on_device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="c1"># If the function that is being decorated is not known yet (i.e. if `fn` is None), then we return the</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="c1"># decorator function. If the function is known, then we decorate and return it.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="k">return</span> <span class="n">decorator</span> <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.on_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></code>

<a href="#evotorch.decorators.on_device" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorator that informs a problem object that this function wants to
receive its solutions on the specified device.</p>
<p>What this decorator does is that it injects a <code>device</code> attribute onto
the decorated callable object. Then, this callable object itself is
returned. Upon seeing the <code>device</code> attribute, the <code>evaluate(...)</code> method
of the <a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a> object will attempt to move the
solutions to that device.</p>
<p>Let us imagine a fitness function <code>f</code> whose definition looks like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>In its not-yet-decorated form, the function <code>f</code> would be given <code>x</code> on the
default device of the associated problem object. However, if one decorates
<code>f</code> as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">on_device</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nd">@on_device</span><span class="p">(</span><span class="s2">&quot;cuda:0&quot;</span><span class="p">)</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>then the Problem object will first move <code>x</code> onto the device cuda:0, and
then will call <code>f</code>.</p>
<p>This decorator is useful on multi-GPU settings. For details, please see
the following example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Problem</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">on_device</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nd">@on_device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="s2">&quot;min&quot;</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">f</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">num_actors</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">num_gpus_per_actor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">)</span>
</code></pre></div>
<p>In the example code above, we assume that there are 4 GPUs available.
The main device of the problem is "cpu", which means the populations
will be generated on the cpu. When evaluating a population, the population
will be split into 4 subbatches (because we have 4 actors), and each
subbatch will be sent to an actor. Thanks to the decorator <code>@on_device</code>,
the <a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a> instance on each actor will first move
its <a class="autorefs autorefs-internal" href="../core/#evotorch.core.SolutionBatch">SolutionBatch</a> to the cuda device visible
to its actor, and then the fitness function <code>f</code> will perform its evaluation
operations on that <a class="autorefs autorefs-internal" href="../core/#evotorch.core.SolutionBatch">SolutionBatch</a> on the
the visible cuda. In summary, the actors will use their associated cuda
devices to evaluate the fitnesses of the solutions in parallel.</p>
<p>This decorator can also be used to decorate the method <code>_evaluate</code> or
<code>_evaluate_batch</code> belonging to a custom subclass of
<a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a>. Please see the example below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Problem</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyCustomProblem</span><span class="p">(</span><span class="n">Problem</span><span class="p">):</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>            <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>  <span class="c1"># populations will be created on the cpu</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>            <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="nd">@on_device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>  <span class="c1"># fitness evaluations will happen on cuda</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solutions</span><span class="p">:</span> <span class="n">SolutionBatch</span><span class="p">):</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        <span class="n">fitnesses</span> <span class="o">=</span> <span class="o">...</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        <span class="n">solutions</span><span class="o">.</span><span class="n">set_evals</span><span class="p">(</span><span class="n">fitnesses</span><span class="p">)</span>
</code></pre></div>
<p>The attribute <code>device</code> that is added by this decorator can be used to
query the fitness device, and also to modify/update it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nd">@on_device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Prints: torch.device(&quot;cpu&quot;)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">f</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span>  <span class="c1"># Evaluations will be done on cuda:0 from now on</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>device</code>
            </td>
            <td>
                  <code><span title="evotorch.tools.Device">Device</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The device on which the decorated fitness function will work.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="k">def</span><span class="w"> </span><span class="nf">on_device</span><span class="p">(</span><span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    Decorator that informs a problem object that this function wants to</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    receive its solutions on the specified device.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    What this decorator does is that it injects a `device` attribute onto</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    the decorated callable object. Then, this callable object itself is</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    returned. Upon seeing the `device` attribute, the `evaluate(...)` method</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    of the [Problem][evotorch.core.Problem] object will attempt to move the</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    solutions to that device.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Let us imagine a fitness function `f` whose definition looks like:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        return torch.sum(x, dim=-1)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    ```</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    In its not-yet-decorated form, the function `f` would be given `x` on the</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    default device of the associated problem object. However, if one decorates</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    `f` as follows:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    from evotorch.decorators import on_device</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    @on_device(&quot;cuda:0&quot;)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        return torch.sum(x, dim=-1)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    ```</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    then the Problem object will first move `x` onto the device cuda:0, and</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    then will call `f`.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    This decorator is useful on multi-GPU settings. For details, please see</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    the following example:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    from evotorch import Problem</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    from evotorch.decorators import on_device</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    @on_device(&quot;cuda&quot;)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor: ...</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    problem = Problem(</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        &quot;min&quot;,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        f,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        num_actors=4,</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        num_gpus_per_actor=1,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        device=&quot;cpu&quot;,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    )</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    ```</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    In the example code above, we assume that there are 4 GPUs available.</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">    The main device of the problem is &quot;cpu&quot;, which means the populations</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    will be generated on the cpu. When evaluating a population, the population</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    will be split into 4 subbatches (because we have 4 actors), and each</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    subbatch will be sent to an actor. Thanks to the decorator `@on_device`,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    the [Problem][evotorch.core.Problem] instance on each actor will first move</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    its [SolutionBatch][evotorch.core.SolutionBatch] to the cuda device visible</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    to its actor, and then the fitness function `f` will perform its evaluation</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    operations on that [SolutionBatch][evotorch.core.SolutionBatch] on the</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    the visible cuda. In summary, the actors will use their associated cuda</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    devices to evaluate the fitnesses of the solutions in parallel.</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    This decorator can also be used to decorate the method `_evaluate` or</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    `_evaluate_batch` belonging to a custom subclass of</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    [Problem][evotorch.core.Problem]. Please see the example below:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    from evotorch import Problem</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    class MyCustomProblem(Problem):</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        def __init__(self):</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">            super().__init__(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">                ...,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">                device=&quot;cpu&quot;,  # populations will be created on the cpu</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">                ...,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">            )</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        @on_device(&quot;cuda&quot;)  # fitness evaluations will happen on cuda</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        def _evaluate_batch(self, solutions: SolutionBatch):</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">            fitnesses = ...</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            solutions.set_evals(fitnesses)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    ```</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    The attribute `device` that is added by this decorator can be used to</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    query the fitness device, and also to modify/update it:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    @on_device(&quot;cpu&quot;)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor: ...</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    print(f.device)  # Prints: torch.device(&quot;cpu&quot;)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    f.device = &quot;cuda:0&quot;  # Evaluations will be done on cuda:0 from now on</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    ```</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        device: The device on which the decorated fitness function will work.</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="c1"># Take the `torch.device` counterpart of `device`</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="nb">setattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;__evotorch_on_device__&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="nb">setattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">return</span> <span class="n">fn</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.pass_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pass_info</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#evotorch.decorators.pass_info" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorates a callable so that the neuroevolution problem class (e.g. GymNE) will
pass information regarding the task at hand, in the form of keyword arguments.</p>
<p>This decorator adds a new attribute named <code>__evotorch_pass_info__</code> to the
decorated callable object, sets this new attribute to True, and then returns
the callable object itself. Upon seeing this attribute with the value <code>True</code>,
a neuroevolution problem class sends extra information as keyword arguments.</p>
<p>For example, in the case of <a class="autorefs autorefs-internal" href="../neuroevolution/#evotorch.neuroevolution.GymNE">GymNE</a> or
<a class="autorefs autorefs-internal" href="../neuroevolution/#evotorch.neuroevolution.VecGymNE">VecGymNE</a>, the passed information would
include dimensions of the observation and action spaces.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nd">@pass_info</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyModule</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">act_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        <span class="c1"># Because MyModule is decorated with @pass_info, it receives</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="c1"># keyword arguments related to the environment &quot;CartPole-v0&quot;,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="c1"># including obs_length and act_length.</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="o">...</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">problem</span> <span class="o">=</span> <span class="n">GymNE</span><span class="p">(</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="s2">&quot;CartPole-v0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">network</span><span class="o">=</span><span class="n">MyModule</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="o">...</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="p">)</span>
</code></pre></div>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn_or_class</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function or class to decorate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Callable</code></td>            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decorated function or class</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">def</span><span class="w"> </span><span class="nf">pass_info</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Decorates a callable so that the neuroevolution problem class (e.g. GymNE) will</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    pass information regarding the task at hand, in the form of keyword arguments.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    This decorator adds a new attribute named `__evotorch_pass_info__` to the</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    decorated callable object, sets this new attribute to True, and then returns</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    the callable object itself. Upon seeing this attribute with the value `True`,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    a neuroevolution problem class sends extra information as keyword arguments.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    For example, in the case of [GymNE][evotorch.neuroevolution.GymNE] or</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    [VecGymNE][evotorch.neuroevolution.VecGymNE], the passed information would</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    include dimensions of the observation and action spaces.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        ```python</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        @pass_info</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        class MyModule(nn.Module):</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">            def __init__(self, obs_length: int, act_length: int, **kwargs):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">                # Because MyModule is decorated with @pass_info, it receives</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">                # keyword arguments related to the environment &quot;CartPole-v0&quot;,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">                # including obs_length and act_length.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">                ...</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        problem = GymNE(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">            &quot;CartPole-v0&quot;,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">            network=MyModule,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">            ...,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        )</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        ```</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        fn_or_class (Callable): Function or class to decorate</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Callable: Decorated function or class</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">return</span> <span class="n">_simple_decorator</span><span class="p">(</span><span class="s2">&quot;__evotorch_pass_info__&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">decorator_name</span><span class="o">=</span><span class="s2">&quot;pass_info&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.rowwise" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rowwise</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">randomness</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">)</span></code>

<a href="#evotorch.decorators.rowwise" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorate a vector-expecting function to make it support batch dimensions.</p>
<p>To be able to decorate a function via <code>@rowwise</code>, the following conditions
are required to be satisfied:
(i) the function expects a single positional argument, which is a PyTorch
tensor;
(ii) the function is implemented with the assumption that the tensor it
receives is a vector (i.e. is 1-dimensional).</p>
<p>Let us consider the example below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nd">@rowwise</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>Notice how the implementation of the function <code>f</code> assumes that its argument
<code>x</code> is 1-dimensional, and based on that assumption, omits the <code>dim</code>
keyword argument when calling <code>torch.sum(...)</code>.</p>
<p>Upon receiving a 1-dimensional tensor, this decorated function <code>f</code> will
perform its operations on the vector <code>x</code>, like how it would work without
the decorator <code>@rowwise</code>.
Upon receiving a 2-dimensional tensor, this decorated function <code>f</code> will
perform its operations on each row of <code>x</code>.
Upon receiving a tensor with 3 or more dimensions, this decorated function
<code>f</code> will interpret its input as a batch of matrices, and perform its
operations on each matrix within the batch.</p>
<p><strong>Defining fitness functions for Problem objects.</strong>
The decorator <code>@rowwise</code> can be used for defining a fitness function for a
<a class="autorefs autorefs-internal" href="../core/#evotorch.core.Problem">Problem</a> object. The advantage of doing so is to be
able to implement the fitness function with the simple assumption that the
input is a vector (that stores decision values for a single solution),
and the output is a scalar (that represents the fitness of the solution).
The decorator <code>@rowwise</code> also flags the decorated function (like
<code>@vectorized</code> does), so, the fitness function is used correctly by the
<code>Problem</code> instance, in a vectorized manner. See the example below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nd">@rowwise</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">fitness</span><span class="p">(</span><span class="n">decision_values</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">decision_values</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">my_problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">fitness</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>
<p>In the example above, thanks to the decorator <code>@rowwise</code>, <code>my_problem</code> will
use <code>fitness</code> in a vectorized manner when evaluating a <code>SolutionBatch</code>,
even though <code>fitness</code> is defined in terms of a single solution.</p>
<p><strong>Randomness.</strong>
Like in <code>torch.func.vmap</code>, the behavior of the decorated function in
terms of randomness can be configured via a keyword argument named
<code>randomness</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nd">@rowwise</span><span class="p">(</span><span class="n">randomness</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
</code></pre></div>
<p>If <code>randomness</code> is set as "error", then, when there is batching, any
attempt to generate random data using PyTorch will raise an error.
If <code>randomness</code> is set as "different", then, a random generation
operation such as <code>torch.randn(...)</code> will produce a <code>BatchedTensor</code>,
where each batch item has its own re-sampled data.
If <code>randomness</code> is set as "same", then, a random generation operation
such as <code>torch.randn(...)</code> will produce a non-batched tensor containing
random data that is sampled only once.</p>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-877" name="__codelineno-0-877"></a><span class="k">def</span><span class="w"> </span><span class="nf">rowwise</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">randomness</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">    Decorate a vector-expecting function to make it support batch dimensions.</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">    To be able to decorate a function via `@rowwise`, the following conditions</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">    are required to be satisfied:</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a><span class="sd">    (i) the function expects a single positional argument, which is a PyTorch</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="sd">    tensor;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">    (ii) the function is implemented with the assumption that the tensor it</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="sd">    receives is a vector (i.e. is 1-dimensional).</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    Let us consider the example below:</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">    @rowwise</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">        return torch.sum(x**2)</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    ```</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">    Notice how the implementation of the function `f` assumes that its argument</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">    `x` is 1-dimensional, and based on that assumption, omits the `dim`</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">    keyword argument when calling `torch.sum(...)`.</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">    Upon receiving a 1-dimensional tensor, this decorated function `f` will</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">    perform its operations on the vector `x`, like how it would work without</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">    the decorator `@rowwise`.</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">    Upon receiving a 2-dimensional tensor, this decorated function `f` will</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">    perform its operations on each row of `x`.</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">    Upon receiving a tensor with 3 or more dimensions, this decorated function</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">    `f` will interpret its input as a batch of matrices, and perform its</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a><span class="sd">    operations on each matrix within the batch.</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">    **Defining fitness functions for Problem objects.**</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="sd">    The decorator `@rowwise` can be used for defining a fitness function for a</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="sd">    [Problem][evotorch.core.Problem] object. The advantage of doing so is to be</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="sd">    able to implement the fitness function with the simple assumption that the</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a><span class="sd">    input is a vector (that stores decision values for a single solution),</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a><span class="sd">    and the output is a scalar (that represents the fitness of the solution).</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a><span class="sd">    The decorator `@rowwise` also flags the decorated function (like</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="sd">    `@vectorized` does), so, the fitness function is used correctly by the</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a><span class="sd">    `Problem` instance, in a vectorized manner. See the example below:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">    @rowwise</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">    def fitness(decision_values: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">        return torch.sqrt(torch.sum(decision_values**2))</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">    my_problem = Problem(&quot;min&quot;, fitness, ...)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">    ```</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="sd">    In the example above, thanks to the decorator `@rowwise`, `my_problem` will</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">    use `fitness` in a vectorized manner when evaluating a `SolutionBatch`,</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">    even though `fitness` is defined in terms of a single solution.</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">    **Randomness.**</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="sd">    Like in `torch.func.vmap`, the behavior of the decorated function in</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">    terms of randomness can be configured via a keyword argument named</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="sd">    `randomness`:</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">    @rowwise(randomness=&quot;error&quot;)</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor: ...</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    ```</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    If `randomness` is set as &quot;error&quot;, then, when there is batching, any</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">    attempt to generate random data using PyTorch will raise an error.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    If `randomness` is set as &quot;different&quot;, then, a random generation</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">    operation such as `torch.randn(...)` will produce a `BatchedTensor`,</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    where each batch item has its own re-sampled data.</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">    If `randomness` is set as &quot;same&quot;, then, a random generation operation</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">    such as `torch.randn(...)` will produce a non-batched tensor containing</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">    random data that is sampled only once.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="n">num_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="k">if</span> <span class="n">num_args</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="n">immediately_decorate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="k">elif</span> <span class="n">num_args</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="n">immediately_decorate</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`rowwise` received invalid number of positional arguments&quot;</span><span class="p">)</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>  <span class="c1"># &lt;- inner decorator</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">decorated</span> <span class="o">=</span> <span class="n">expects_ndim</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">randomness</span><span class="o">=</span><span class="n">randomness</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="n">decorated</span><span class="o">.</span><span class="n">__evotorch_vectorized__</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="k">return</span> <span class="n">decorated</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>    <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">immediately_decorate</span> <span class="k">else</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="evotorch.decorators.vectorized" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vectorized</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#evotorch.decorators.vectorized" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Decorates a fitness function so that the problem object (which can be an instance
of <a class="autorefs autorefs-internal" title="Problem" href="../core/#evotorch.core.Problem">evotorch.Problem</a>) will send the fitness function a 2D
tensor containing all the solutions, instead of a 1D tensor containing a single
solution.</p>
<p>What this decorator does is that it adds the decorated fitness function a new
attribute named <code>__evotorch_vectorized__</code>, the value of this new attribute being
True. Upon seeing this new attribute, the problem object will send this function
multiple solutions so that vectorized operations on multiple solutions can be
performed by this fitness function.</p>
<p>Let us imagine that we have the following fitness function which works on a
single solution <code>x</code>, and returns a single fitness value:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>...and let us now define the optimization problem associated with this fitness
function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">p1</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">initial_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span> <span class="n">solution_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>While the fitness function <code>f</code> and the definition <code>p1</code> form a valid problem
description, it does not use PyTorch to its full potential in terms of performance.
If we were to request the evaluation results on a population of solutions via
<code>p1.evaluate(population)</code>, <code>p1</code> would use a classic <code>for</code> loop to evaluate every
single solution within <code>population</code> one by one.
We could greatly increase our performance by:
(i) re-defining our fitness function in a vectorized manner, i.e. in such a way
that it will operate on many solutions and compute all of their fitnesses at once;
(ii) label our fitness function via <code>@vectorized</code>, so that the problem object
will be aware that this new fitness function expects <code>n</code> solutions and returns
<code>n</code> fitnesses. The re-designed and labeled fitness function looks like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">evotorch.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">vectorized</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nd">@vectorized</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>The problem description for <code>f2</code> is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">p2</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">initial_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span> <span class="n">solution_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>In this last example, <code>p2</code> will realize that <code>f2</code> is decorated via <code>@vectorized</code>,
and will send it <code>n</code> solutions, and will receive and process <code>n</code> fitnesses.</p>


            <details class="quote">
              <summary>Source code in <code>evotorch/decorators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="k">def</span><span class="w"> </span><span class="nf">vectorized</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    Decorates a fitness function so that the problem object (which can be an instance</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    of [evotorch.Problem][evotorch.core.Problem]) will send the fitness function a 2D</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    tensor containing all the solutions, instead of a 1D tensor containing a single</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    solution.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    What this decorator does is that it adds the decorated fitness function a new</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">    attribute named `__evotorch_vectorized__`, the value of this new attribute being</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    True. Upon seeing this new attribute, the problem object will send this function</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">    multiple solutions so that vectorized operations on multiple solutions can be</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    performed by this fitness function.</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    Let us imagine that we have the following fitness function which works on a</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">    single solution `x`, and returns a single fitness value:</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">    import torch</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">    def f(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        return torch.sum(x**2)</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    ```</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    ...and let us now define the optimization problem associated with this fitness</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">    function:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">    p1 = Problem(&quot;min&quot;, f, initial_bounds=(-10.0, 10.0), solution_length=5)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    ```</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    While the fitness function `f` and the definition `p1` form a valid problem</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    description, it does not use PyTorch to its full potential in terms of performance.</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    If we were to request the evaluation results on a population of solutions via</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    `p1.evaluate(population)`, `p1` would use a classic `for` loop to evaluate every</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    single solution within `population` one by one.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    We could greatly increase our performance by:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    (i) re-defining our fitness function in a vectorized manner, i.e. in such a way</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">    that it will operate on many solutions and compute all of their fitnesses at once;</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">    (ii) label our fitness function via `@vectorized`, so that the problem object</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    will be aware that this new fitness function expects `n` solutions and returns</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    `n` fitnesses. The re-designed and labeled fitness function looks like this:</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">    from evotorch.decorators import vectorized</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    @vectorized</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    def f2(x: torch.Tensor) -&gt; torch.Tensor:</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">        return torch.sum(x**2, dim=-1)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">    ```</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">    The problem description for `f2` is:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">    p2 = Problem(&quot;min&quot;, f2, initial_bounds=(-10.0, 10.0), solution_length=5)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">    ```</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">    In this last example, `p2` will realize that `f2` is decorated via `@vectorized`,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    and will send it `n` solutions, and will receive and process `n` fitnesses.</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="k">return</span> <span class="n">_simple_decorator</span><span class="p">(</span><span class="s2">&quot;__evotorch_vectorized__&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">decorator_name</span><span class="o">=</span><span class="s2">&quot;vectorized&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 NNAISENSE SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>